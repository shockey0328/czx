<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‘¨åº¦æ•°æ®åˆ†æçœ‹æ¿</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            height: 100vh;
            overflow: hidden;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .navbar {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo img {
            height: 40px;
            width: auto;
        }

        .logo-text {
            font-size: 24px;
            font-weight: bold;
            color: #FF6B35;
        }

        .week-dropdown {
            padding: 10px 15px;
            border: 2px solid #FF6B35;
            border-radius: 8px;
            background: white;
            color: #333;
            font-size: 16px;
            min-width: 200px;
            cursor: pointer;
        }

        /* ä¸»è¦å†…å®¹åŒºåŸŸ - å››å®«æ ¼å¸ƒå±€ */
        .main-content {
            height: calc(100vh - 70px);
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 2fr 1fr;
            gap: 15px;
            padding: 15px;
        }

        /* é€šç”¨é¢æ¿æ ·å¼ */
        .panel {
            background: white;
            border-radius: 12px;
            padding: 18px;
            box-shadow: 0 6px 24px rgba(0,0,0,0.08);
            overflow: auto;
            border: 1px solid rgba(255, 107, 53, 0.1);
        }

        .panel-title {
            color: #FF6B35;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .panel-title::before {
            content: '';
            width: 3px;
            height: 18px;
            background: #FF6B35;
            margin-right: 10px;
            border-radius: 2px;
        }

        /* å·¦ä¸Šï¼šå‘¨åº¦æ ¸å¿ƒæ•°æ®æŒ‡æ ‡ */
        .core-metrics {
            grid-area: 1 / 1 / 2 / 2;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
        }

        .metric-group {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 12px;
            border-left: 3px solid #FF6B35;
            min-height: 120px;
        }

        .metric-group h4 {
            color: #FF6B35;
            margin-bottom: 10px;
            font-size: 14px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 6px;
        }

        .metric-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 8px;
            padding: 4px 0;
            border-bottom: 1px solid #eee;
            text-align: center;
        }

        .metric-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }

        .metric-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 3px;
        }

        .metric-value {
            font-size: 15px;
            font-weight: 700;
            color: #333;
            margin-bottom: 4px;
        }

        .metric-changes {
            display: flex;
            flex-direction: column;
            gap: 2px;
            align-items: center;
        }

        .change-item {
            font-size: 9px;
            padding: 1px 4px;
            border-radius: 3px;
            background: #f1f3f4;
            white-space: nowrap;
        }

        /* ä¸­å›½é£æ ¼é¢œè‰²ï¼šçº¢æ¶¨ç»¿è·Œ */
        .change-item.positive {
            background: #ffebee;
            color: #d32f2f;
        }

        .change-item.negative {
            background: #e8f5e8;
            color: #388e3c;
        }

        /* å·¦ä¸‹ï¼šBç«¯æ ¸å¿ƒæ•°æ®æŒ‡æ ‡ */
        .b2b-metrics {
            grid-area: 2 / 1 / 3 / 2;
        }

        .b2b-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 10px;
        }

        .b2b-metric-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            border: 2px solid #FFA366;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .b2b-metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #FF6B35, #FFA366);
        }

        .b2b-metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.15);
        }

        .b2b-metric-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 4px;
        }

        .b2b-metric-value {
            font-size: 15px;
            font-weight: 700;
            color: #FF6B35;
        }

        /* å³ä¸Šï¼šè¶‹åŠ¿åˆ†æ */
        .trends-analysis {
            grid-area: 1 / 2 / 2 / 3;
        }

        .trends-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .period-selector {
            display: flex;
            gap: 5px;
            background: #f8f9fa;
            padding: 3px;
            border-radius: 8px;
        }

        .period-btn {
            padding: 6px 12px;
            border: none;
            background: transparent;
            color: #666;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .period-btn:hover,
        .period-btn.active {
            background: #FF6B35;
            color: white;
        }

        .charts-container {
            height: calc(100% - 50px);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .chart-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
        }

        .chart-item h5 {
            color: #333;
            margin-bottom: 8px;
            font-size: 13px;
            text-align: center;
        }

        .chart-item canvas {
            max-height: 110px;
        }

        /* å³ä¸‹ï¼šAIæ•°æ®åˆ†æ */
        .ai-analysis {
            grid-area: 2 / 2 / 3 / 3;
        }

        .ai-header {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            margin-bottom: 12px;
        }

        .ai-title {
            color: #FF6B35;
            font-size: 18px;
            font-weight: 600;
            margin: 0;
            display: flex;
            align-items: center;
        }

        .ai-title::before {
            content: '';
            width: 3px;
            height: 18px;
            background: #FF6B35;
            margin-right: 10px;
            border-radius: 2px;
        }

        .deepseek-badge {
            font-size: 10px;
            color: #666;
            background: #f0f0f0;
            padding: 3px 8px;
            border-radius: 12px;
            border: 1px solid #ddd;
        }

        .ai-content {
            background: white;
            border-radius: 8px;
            padding: 15px;
            height: calc(100% - 80px);
            overflow-y: auto;
        }

        .ai-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            height: 100%;
        }

        .ai-column {
            display: flex;
            flex-direction: column;
        }

        .analysis-section {
            margin-bottom: 15px;
            flex: 1;
        }

        .analysis-section h5 {
            color: #FF6B35;
            margin-bottom: 10px;
            font-size: 13px;
            font-weight: 600;
            padding-bottom: 5px;
            border-bottom: 2px solid #FF6B35;
            position: relative;
        }

        .analysis-content {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 12px;
            height: calc(100% - 35px);
            border-left: 3px solid #FF6B35;
        }

        .key-metrics-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }

        .metric-display {
            text-align: center;
            padding: 8px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e9ecef;
        }

        .metric-display .label {
            font-size: 9px;
            color: #666;
            margin-bottom: 2px;
        }

        .metric-display .value {
            font-size: 14px;
            font-weight: 700;
            color: #FF6B35;
        }

        .analysis-text {
            font-size: 11px;
            line-height: 1.4;
            color: #555;
        }

        .analysis-list {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .analysis-list li {
            margin-bottom: 6px;
            padding-left: 12px;
            font-size: 11px;
            line-height: 1.4;
            color: #555;
            position: relative;
        }

        .analysis-list li::before {
            content: 'â€¢';
            position: absolute;
            left: 0;
            color: #FF6B35;
            font-weight: bold;
        }

        .ai-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0 0 0;
        }

        .ai-status {
            display: flex;
            gap: 8px;
        }

        .status-btn {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 10px;
            border: none;
            cursor: pointer;
            font-weight: 500;
        }

        .status-btn.active {
            background: #4CAF50;
            color: white;
        }

        .status-btn.refresh {
            background: #f0f0f0;
            color: #666;
            border: 1px solid #ddd;
        }

        .ai-credit {
            font-size: 9px;
            color: #999;
        }

        .loading {
            text-align: center;
            color: #999;
            font-style: italic;
            padding: 20px;
            font-size: 11px;
            grid-column: 1 / -1;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto auto;
                height: auto;
                min-height: calc(100vh - 70px);
            }
            
            .panel {
                grid-area: auto;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            body {
                overflow: auto;
            }
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                height: auto;
                padding: 15px;
                gap: 15px;
            }
            
            .main-content {
                padding: 10px;
                gap: 15px;
            }
            
            .panel {
                padding: 15px;
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
            
            .b2b-grid {
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(3, 1fr);
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .ai-grid {
                grid-template-columns: 1fr;
            }
            
            .deepseek-badge {
                font-size: 8px;
                padding: 1px 4px;
            }
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="navbar">
        <div class="logo">
            <img src="logo.png" alt="Logo">
            <span class="logo-text">å‘¨åº¦æ•°æ®åˆ†æçœ‹æ¿</span>
        </div>
        <select id="weekSelect" class="week-dropdown">
            <option value="">é€‰æ‹©å‘¨åº¦...</option>
        </select>
    </header>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ - å››å®«æ ¼å¸ƒå±€ -->
    <div class="main-content">
        <!-- å·¦ä¸Šï¼šå‘¨åº¦æ ¸å¿ƒæ•°æ®æŒ‡æ ‡ -->
        <div class="panel core-metrics">
            <h3 class="panel-title">å‘¨åº¦æ ¸å¿ƒæ•°æ®æŒ‡æ ‡</h3>
            <div class="metrics-grid">
                <!-- ç”¨æˆ·æŒ‡æ ‡ -->
                <div class="metric-group">
                    <h4>ç”¨æˆ·æŒ‡æ ‡</h4>
                    <div class="metric-item">
                        <span class="metric-label">æ´»è·ƒç”¨æˆ·</span>
                        <span class="metric-value" id="activeUsers">-</span>
                        <div class="metric-changes">
                            <span class="change-item" id="activeUsersWoW">ç¯æ¯”: -</span>
                            <span class="change-item" id="activeUsersYoY">åŒæ¯”: -</span>
                        </div>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">æ¬¡å‘¨ç•™å­˜ç‡</span>
                        <span class="metric-value" id="retention">-</span>
                        <div class="metric-changes">
                            <span class="change-item" id="retentionWoW">ç¯æ¯”: -</span>
                            <span class="change-item" id="retentionYoY">åŒæ¯”: -</span>
                        </div>
                    </div>
                </div>

                <!-- æ”¶å…¥æŒ‡æ ‡ -->
                <div class="metric-group">
                    <h4>æ”¶å…¥æŒ‡æ ‡</h4>
                    <div class="metric-item">
                        <span class="metric-label">è¥æ”¶</span>
                        <span class="metric-value" id="revenue">-</span>
                        <div class="metric-changes">
                            <span class="change-item" id="revenueWoW">ç¯æ¯”: -</span>
                            <span class="change-item" id="revenueYoY">åŒæ¯”: -</span>
                        </div>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">ARPU</span>
                        <span class="metric-value" id="arpu">-</span>
                        <div class="metric-changes">
                            <span class="change-item" id="arpuWoW">ç¯æ¯”: -</span>
                            <span class="change-item" id="arpuYoY">åŒæ¯”: -</span>
                        </div>
                    </div>
                </div>

                <!-- ä½¿ç”¨æŒ‡æ ‡ -->
                <div class="metric-group">
                    <h4>ä½¿ç”¨æŒ‡æ ‡</h4>
                    <div class="metric-item">
                        <span class="metric-label">æ·±åº¦è®¿é—®ç‡</span>
                        <span class="metric-value" id="deepAccess">-</span>
                        <div class="metric-changes">
                            <span class="change-item" id="deepAccessWoW">ç¯æ¯”: -</span>
                            <span class="change-item" id="deepAccessYoY">åŒæ¯”: -</span>
                        </div>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">ä½¿ç”¨ç‡</span>
                        <span class="metric-value" id="usageRate">-</span>
                        <div class="metric-changes">
                            <span class="change-item" id="usageRateWoW">ç¯æ¯”: -</span>
                            <span class="change-item" id="usageRateYoY">åŒæ¯”: -</span>
                        </div>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">å¤§ä¼šå‘˜æ´»è·ƒç‡</span>
                        <span class="metric-value" id="vipActive">-</span>
                        <div class="metric-changes">
                            <span class="change-item" id="vipActiveWoW">ç¯æ¯”: -</span>
                            <span class="change-item" id="vipActiveYoY">åŒæ¯”: -</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å³ä¸Šï¼šè¶‹åŠ¿åˆ†æ -->
        <div class="panel trends-analysis">
            <h3 class="panel-title">è¶‹åŠ¿åˆ†æ</h3>
            <div class="trends-header">
                <div class="period-selector">
                    <button class="period-btn" data-weeks="2">è¿‘2å‘¨</button>
                    <button class="period-btn active" data-weeks="3">è¿‘3å‘¨</button>
                    <button class="period-btn" data-weeks="4">è¿‘4å‘¨</button>
                </div>
            </div>
            <div class="charts-container">
                <div class="chart-item">
                    <h5>æ´»è·ƒç”¨æˆ·è¶‹åŠ¿</h5>
                    <canvas id="activeUsersChart"></canvas>
                </div>
                <div class="chart-item">
                    <h5>ä»˜è´¹ç”¨æˆ·è¶‹åŠ¿</h5>
                    <canvas id="paidUsersChart"></canvas>
                </div>
                <div class="chart-item">
                    <h5>è¥æ”¶è¶‹åŠ¿</h5>
                    <canvas id="revenueChart"></canvas>
                </div>
                <div class="chart-item">
                    <h5>ä½¿ç”¨ç‡è¶‹åŠ¿</h5>
                    <canvas id="usageChart"></canvas>
                </div>
            </div>
        </div>

        <!-- å·¦ä¸‹ï¼šBç«¯æ ¸å¿ƒæ•°æ®æŒ‡æ ‡ -->
        <div class="panel b2b-metrics">
            <h3 class="panel-title">Bç«¯æ ¸å¿ƒæ•°æ®æŒ‡æ ‡</h3>
            <div class="b2b-grid" id="b2bMetrics">
                <!-- Bç«¯æŒ‡æ ‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- å³ä¸‹ï¼šAIæ•°æ®åˆ†æ -->
        <div class="panel ai-analysis">
            <div class="ai-header">
                <h3 class="ai-title">ğŸ¤– AIæ•°æ®åˆ†æ</h3>
            </div>
            <div class="ai-content">
                <div class="ai-grid" id="aiAnalysis">
                    <div class="loading">æ­£åœ¨åˆ†ææ•°æ®...</div>
                </div>
            </div>
            <div class="ai-footer">
                <div class="ai-status">
                    <button class="status-btn active">æ™ºèƒ½åˆ†æ</button>
                    <button class="status-btn refresh">åˆ·æ–°åˆ†æ</button>
                </div>
                <div class="ai-credit">ç”± DeepSeek AI æä¾›æŠ€æœ¯æ”¯æŒ</div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let weeklyData = [];
        let b2bData = [];
        let currentWeek = null;
        let charts = {};

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
            initializeApp();
        });

        // åˆå§‹åŒ–åº”ç”¨
        function initializeApp() {
            loadHardcodedData();
            setupEventListeners();
            populateWeekSelector();
            updateB2BMetrics();
            
            // é»˜è®¤é€‰æ‹©æœ€æ–°å‘¨åº¦
            if (weeklyData.length > 0) {
                const latestWeek = weeklyData[weeklyData.length - 1];
                currentWeek = { year: latestWeek.å¹´ä»½, week: latestWeek.å‘¨æ•° };
                document.getElementById('weekSelect').value = JSON.stringify(currentWeek);
                updateAllMetrics();
                updateCharts();
                generateAIAnalysis();
            }
        }

        // åŠ è½½ç¡¬ç¼–ç æ•°æ®
        function loadHardcodedData() {
            console.log('åŠ è½½ç¡¬ç¼–ç æ•°æ®...');
            
            // å‘¨åº¦æ ¸å¿ƒæ•°æ®
            weeklyData = [
                {
                    å¹´ä»½: 2025,
                    å‘¨æ•°: 1,
                    èµ·å§‹æ—¥æœŸ: '2025å¹´1æœˆ1æ—¥',
                    ç»“å°¾æ—¥æœŸ: '2025å¹´1æœˆ7æ—¥',
                    æ´»è·ƒç”¨æˆ·: 119000,
                    æ¬¡å‘¨ç•™å­˜ç‡: 46,
                    è¥æ”¶: 199039,
                    ARPU: 1.67,
                    æ·±åº¦è®¿é—®ç‡: 84,
                    ä½¿ç”¨ç‡: 65,
                    å¤§ä¼šå‘˜æ´»è·ƒç‡: 61
                },
                {
                    å¹´ä»½: 2025,
                    å‘¨æ•°: 2,
                    èµ·å§‹æ—¥æœŸ: '2025å¹´1æœˆ8æ—¥',
                    ç»“å°¾æ—¥æœŸ: '2025å¹´1æœˆ14æ—¥',
                    æ´»è·ƒç”¨æˆ·: 125585,
                    æ¬¡å‘¨ç•™å­˜ç‡: 38,
                    è¥æ”¶: 173441,
                    ARPU: 1.38,
                    æ·±åº¦è®¿é—®ç‡: 83,
                    ä½¿ç”¨ç‡: 62,
                    å¤§ä¼šå‘˜æ´»è·ƒç‡: 57
                },
                {
                    å¹´ä»½: 2025,
                    å‘¨æ•°: 3,
                    èµ·å§‹æ—¥æœŸ: '2025å¹´1æœˆ15æ—¥',
                    ç»“å°¾æ—¥æœŸ: '2025å¹´1æœˆ21æ—¥',
                    æ´»è·ƒç”¨æˆ·: 96407,
                    æ¬¡å‘¨ç•™å­˜ç‡: 27,
                    è¥æ”¶: 100709,
                    ARPU: 1.04,
                    æ·±åº¦è®¿é—®ç‡: 77,
                    ä½¿ç”¨ç‡: 52,
                    å¤§ä¼šå‘˜æ´»è·ƒç‡: 43
                },
                {
                    å¹´ä»½: 2025,
                    å‘¨æ•°: 4,
                    èµ·å§‹æ—¥æœŸ: '2025å¹´1æœˆ22æ—¥',
                    ç»“å°¾æ—¥æœŸ: '2025å¹´1æœˆ28æ—¥',
                    æ´»è·ƒç”¨æˆ·: 59814,
                    æ¬¡å‘¨ç•™å­˜ç‡: 21,
                    è¥æ”¶: 76057,
                    ARPU: 1.27,
                    æ·±åº¦è®¿é—®ç‡: 75,
                    ä½¿ç”¨ç‡: 51,
                    å¤§ä¼šå‘˜æ´»è·ƒç‡: 32
                },
                {
                    å¹´ä»½: 2026,
                    å‘¨æ•°: 1,
                    èµ·å§‹æ—¥æœŸ: '2026å¹´1æœˆ1æ—¥',
                    ç»“å°¾æ—¥æœŸ: '2026å¹´1æœˆ7æ—¥',
                    æ´»è·ƒç”¨æˆ·: 103932,
                    æ¬¡å‘¨ç•™å­˜ç‡: 42,
                    è¥æ”¶: 232351,
                    ARPU: 2.24,
                    æ·±åº¦è®¿é—®ç‡: 83,
                    ä½¿ç”¨ç‡: 74,
                    å¤§ä¼šå‘˜æ´»è·ƒç‡: 50
                },
                {
                    å¹´ä»½: 2026,
                    å‘¨æ•°: 2,
                    èµ·å§‹æ—¥æœŸ: '2026å¹´1æœˆ8æ—¥',
                    ç»“å°¾æ—¥æœŸ: '2026å¹´1æœˆ14æ—¥',
                    æ´»è·ƒç”¨æˆ·: 117167,
                    æ¬¡å‘¨ç•™å­˜ç‡: 43,
                    è¥æ”¶: 303052,
                    ARPU: 2.59,
                    æ·±åº¦è®¿é—®ç‡: 85,
                    ä½¿ç”¨ç‡: 75,
                    å¤§ä¼šå‘˜æ´»è·ƒç‡: 51
                },
                {
                    å¹´ä»½: 2026,
                    å‘¨æ•°: 3,
                    èµ·å§‹æ—¥æœŸ: '2026å¹´1æœˆ15æ—¥',
                    ç»“å°¾æ—¥æœŸ: '2026å¹´1æœˆ21æ—¥',
                    æ´»è·ƒç”¨æˆ·: 133661,
                    æ¬¡å‘¨ç•™å­˜ç‡: 44,
                    è¥æ”¶: 298800,
                    ARPU: 2.24,
                    æ·±åº¦è®¿é—®ç‡: 86,
                    ä½¿ç”¨ç‡: 75,
                    å¤§ä¼šå‘˜æ´»è·ƒç‡: 52
                },
                {
                    å¹´ä»½: 2026,
                    å‘¨æ•°: 4,
                    èµ·å§‹æ—¥æœŸ: '2026å¹´1æœˆ22æ—¥',
                    ç»“å°¾æ—¥æœŸ: '2026å¹´1æœˆ28æ—¥',
                    æ´»è·ƒç”¨æˆ·: 137602,
                    æ¬¡å‘¨ç•™å­˜ç‡: 42,
                    è¥æ”¶: 270348,
                    ARPU: 1.96,
                    æ·±åº¦è®¿é—®ç‡: 86,
                    ä½¿ç”¨ç‡: 75,
                    å¤§ä¼šå‘˜æ´»è·ƒç‡: 50
                }
            ];

            // Bç«¯æ•°æ®
            b2bData = [
                {
                    èµ·å§‹æ—¥æœŸ: '2026å¹´1æœˆ1æ—¥',
                    ç»“å°¾æ—¥æœŸ: '2026å¹´1æœˆ7æ—¥',
                    ç­¾çº¦é‡‘é¢: '1.80ä¸‡',
                    å¼€ç¥¨é‡‘é¢: '3.05ä¸‡',
                    å›æ¬¾é‡‘é¢: '2.00ä¸‡',
                    è®¢å•æ•°: 3,
                    æ–°ç­¾: 1,
                    ç»­ç­¾: 2
                },
                {
                    èµ·å§‹æ—¥æœŸ: '2026å¹´1æœˆ8æ—¥',
                    ç»“å°¾æ—¥æœŸ: '2026å¹´1æœˆ14æ—¥',
                    ç­¾çº¦é‡‘é¢: '5.30ä¸‡',
                    å¼€ç¥¨é‡‘é¢: '1.60ä¸‡',
                    å›æ¬¾é‡‘é¢: '4.40ä¸‡',
                    è®¢å•æ•°: 4,
                    æ–°ç­¾: 1,
                    ç»­ç­¾: 3
                },
                {
                    èµ·å§‹æ—¥æœŸ: '2026å¹´1æœˆ15æ—¥',
                    ç»“å°¾æ—¥æœŸ: '2026å¹´1æœˆ21æ—¥',
                    ç­¾çº¦é‡‘é¢: '4.89ä¸‡',
                    å¼€ç¥¨é‡‘é¢: '1.26ä¸‡',
                    å›æ¬¾é‡‘é¢: '3.66ä¸‡',
                    è®¢å•æ•°: 7,
                    æ–°ç­¾: 5,
                    ç»­ç­¾: 2
                },
                {
                    èµ·å§‹æ—¥æœŸ: '2026å¹´1æœˆ22æ—¥',
                    ç»“å°¾æ—¥æœŸ: '2026å¹´1æœˆ28æ—¥',
                    ç­¾çº¦é‡‘é¢: '4.36ä¸‡',
                    å¼€ç¥¨é‡‘é¢: '6.91ä¸‡',
                    å›æ¬¾é‡‘é¢: '4.36ä¸‡',
                    è®¢å•æ•°: 5,
                    æ–°ç­¾: 1,
                    ç»­ç­¾: 4
                }
            ];

            // æ¯æ—¥è¶‹åŠ¿æ•°æ®
            loadDailyTrendData();

            console.log('æ•°æ®åŠ è½½å®Œæˆ:', { weeklyData, b2bData });
        }

        // åŠ è½½æ¯æ—¥è¶‹åŠ¿æ•°æ®
        function loadDailyTrendData() {
            // æ´»è·ƒç”¨æˆ·æ¯æ—¥æ•°æ®
            window.dailyActiveUsers = [
                { date: '2026/1/1', uv: 22054 },
                { date: '2026/1/2', uv: 27358 },
                { date: '2026/1/3', uv: 30989 },
                { date: '2026/1/4', uv: 21786 },
                { date: '2026/1/5', uv: 23213 },
                { date: '2026/1/6', uv: 24064 },
                { date: '2026/1/7', uv: 25342 },
                { date: '2026/1/8', uv: 25628 },
                { date: '2026/1/9', uv: 24084 },
                { date: '2026/1/10', uv: 32033 },
                { date: '2026/1/11', uv: 37160 },
                { date: '2026/1/12', uv: 26331 },
                { date: '2026/1/13', uv: 27026 },
                { date: '2026/1/14', uv: 28507 },
                { date: '2026/1/15', uv: 28668 },
                { date: '2026/1/16', uv: 28278 },
                { date: '2026/1/17', uv: 38770 },
                { date: '2026/1/18', uv: 43999 },
                { date: '2026/1/19', uv: 30309 },
                { date: '2026/1/20', uv: 30876 },
                { date: '2026/1/21', uv: 30947 },
                { date: '2026/1/22', uv: 30836 },
                { date: '2026/1/23', uv: 29666 },
                { date: '2026/1/24', uv: 40933 },
                { date: '2026/1/25', uv: 45337 },
                { date: '2026/1/26', uv: 31735 },
                { date: '2026/1/27', uv: 31854 },
                { date: '2026/1/28', uv: 31571 }
            ];

            // ä»˜è´¹ç”¨æˆ·æ¯æ—¥æ•°æ®
            window.dailyPaidUsers = [
                { date: '2026/1/1', paidUsers: 345, revenue: 29247 },
                { date: '2026/1/2', paidUsers: 406, revenue: 35488 },
                { date: '2026/1/3', paidUsers: 437, revenue: 39576 },
                { date: '2026/1/4', paidUsers: 342, revenue: 27809 },
                { date: '2026/1/5', paidUsers: 356, revenue: 31528 },
                { date: '2026/1/6', paidUsers: 377, revenue: 36626 },
                { date: '2026/1/7', paidUsers: 364, revenue: 31381 },
                { date: '2026/1/8', paidUsers: 394, revenue: 38861 },
                { date: '2026/1/9', paidUsers: 365, revenue: 32735 },
                { date: '2026/1/10', paidUsers: 589, revenue: 58350 },
                { date: '2026/1/11', paidUsers: 644, revenue: 62932 },
                { date: '2026/1/12', paidUsers: 412, revenue: 37436 },
                { date: '2026/1/13', paidUsers: 393, revenue: 33818 },
                { date: '2026/1/14', paidUsers: 417, revenue: 38871 },
                { date: '2026/1/15', paidUsers: 342, revenue: 32175 },
                { date: '2026/1/16', paidUsers: 414, revenue: 41424 },
                { date: '2026/1/17', paidUsers: 620, revenue: 61948 },
                { date: '2026/1/18', paidUsers: 659, revenue: 62795 },
                { date: '2026/1/19', paidUsers: 360, revenue: 33992 },
                { date: '2026/1/20', paidUsers: 330, revenue: 31301 },
                { date: '2026/1/21', paidUsers: 364, revenue: 34848 },
                { date: '2026/1/22', paidUsers: 331, revenue: 30643 },
                { date: '2026/1/23', paidUsers: 354, revenue: 33719 },
                { date: '2026/1/24', paidUsers: 598, revenue: 59098 },
                { date: '2026/1/25', paidUsers: 580, revenue: 54974 },
                { date: '2026/1/26', paidUsers: 327, revenue: 31842 },
                { date: '2026/1/27', paidUsers: 301, revenue: 30500 },
                { date: '2026/1/28', paidUsers: 302, revenue: 29572 }
            ];

            // ä½¿ç”¨ç‡æ¯æ—¥æ•°æ®
            window.dailyUsageRate = [
                { date: '2026/1/1', usageRate: 63.68 },
                { date: '2026/1/2', usageRate: 66.87 },
                { date: '2026/1/3', usageRate: 68.95 },
                { date: '2026/1/4', usageRate: 68.11 },
                { date: '2026/1/5', usageRate: 69.35 },
                { date: '2026/1/6', usageRate: 68.51 },
                { date: '2026/1/7', usageRate: 68.4 },
                { date: '2026/1/8', usageRate: 67.55 },
                { date: '2026/1/9', usageRate: 65.83 },
                { date: '2026/1/10', usageRate: 68.12 },
                { date: '2026/1/11', usageRate: 70.15 },
                { date: '2026/1/12', usageRate: 69.06 },
                { date: '2026/1/13', usageRate: 68.82 },
                { date: '2026/1/14', usageRate: 68.38 },
                { date: '2026/1/15', usageRate: 68.39 },
                { date: '2026/1/16', usageRate: 66.28 },
                { date: '2026/1/17', usageRate: 68.85 },
                { date: '2026/1/18', usageRate: 71.07 },
                { date: '2026/1/19', usageRate: 68.87 },
                { date: '2026/1/20', usageRate: 68.76 },
                { date: '2026/1/21', usageRate: 69.48 },
                { date: '2026/1/22', usageRate: 68.69 },
                { date: '2026/1/23', usageRate: 66.37 },
                { date: '2026/1/24', usageRate: 69.23 },
                { date: '2026/1/25', usageRate: 70.43 },
                { date: '2026/1/26', usageRate: 67.56 },
                { date: '2026/1/27', usageRate: 66.66 },
                { date: '2026/1/28', usageRate: 65.1 }
            ];
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            console.log('è®¾ç½®äº‹ä»¶ç›‘å¬å™¨...');
            
            // å‘¨åº¦é€‰æ‹©å™¨
            const weekSelect = document.getElementById('weekSelect');
            if (weekSelect) {
                weekSelect.addEventListener('change', function(e) {
                    console.log('å‘¨åº¦é€‰æ‹©å˜åŒ–:', e.target.value);
                    const selectedWeek = e.target.value;
                    if (selectedWeek) {
                        try {
                            currentWeek = JSON.parse(selectedWeek);
                            console.log('å½“å‰é€‰æ‹©çš„å‘¨åº¦:', currentWeek);
                            updateAllMetrics();
                            updateCharts();
                            generateAIAnalysis();
                        } catch (error) {
                            console.error('è§£æå‘¨åº¦æ•°æ®å¤±è´¥:', error);
                        }
                    }
                });
            }

            // è¶‹åŠ¿å›¾å‘¨æœŸé€‰æ‹©å™¨
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateCharts();
                });
            });
        }

        // å¡«å……å‘¨åº¦é€‰æ‹©å™¨
        function populateWeekSelector() {
            console.log('å¡«å……å‘¨åº¦é€‰æ‹©å™¨...');
            const select = document.getElementById('weekSelect');
            if (!select) {
                console.error('æ‰¾ä¸åˆ°å‘¨åº¦é€‰æ‹©å™¨å…ƒç´ ');
                return;
            }
            
            select.innerHTML = '<option value="">é€‰æ‹©å‘¨åº¦...</option>';
            
            weeklyData.forEach(item => {
                const option = document.createElement('option');
                const weekKey = JSON.stringify({ year: item.å¹´ä»½, week: item.å‘¨æ•° });
                option.value = weekKey;
                option.textContent = `${item.å¹´ä»½}å¹´ç¬¬${item.å‘¨æ•°}å‘¨`;
                select.appendChild(option);
            });
            
            console.log('å‘¨åº¦é€‰æ‹©å™¨å¡«å……å®Œæˆï¼Œå…±', weeklyData.length, 'ä¸ªé€‰é¡¹');
        }

        // æ›´æ–°æ‰€æœ‰æŒ‡æ ‡
        function updateAllMetrics() {
            console.log('æ›´æ–°æ‰€æœ‰æŒ‡æ ‡ï¼Œå½“å‰å‘¨åº¦:', currentWeek);
            
            if (!currentWeek) {
                console.log('æ²¡æœ‰é€‰æ‹©å‘¨åº¦ï¼Œè·³è¿‡æ›´æ–°');
                return;
            }
            
            const currentData = weeklyData.find(item => 
                item.å¹´ä»½ === currentWeek.year && item.å‘¨æ•° === currentWeek.week
            );
            
            if (!currentData) {
                console.log('æ‰¾ä¸åˆ°å½“å‰å‘¨åº¦çš„æ•°æ®');
                return;
            }

            console.log('å½“å‰å‘¨åº¦æ•°æ®:', currentData);

            // è·å–å¯¹æ¯”æ•°æ®
            const lastWeekData = weeklyData.find(item => 
                item.å¹´ä»½ === currentWeek.year && item.å‘¨æ•° === currentWeek.week - 1
            );
            
            const lastYearData = weeklyData.find(item => 
                item.å¹´ä»½ === currentWeek.year - 1 && item.å‘¨æ•° === currentWeek.week
            );

            console.log('ä¸Šå‘¨æ•°æ®:', lastWeekData);
            console.log('å»å¹´åŒæœŸæ•°æ®:', lastYearData);

            // æ›´æ–°æŒ‡æ ‡
            updateMetric('activeUsers', currentData.æ´»è·ƒç”¨æˆ·, lastWeekData?.æ´»è·ƒç”¨æˆ·, lastYearData?.æ´»è·ƒç”¨æˆ·, 'number');
            updateMetric('retention', currentData.æ¬¡å‘¨ç•™å­˜ç‡, lastWeekData?.æ¬¡å‘¨ç•™å­˜ç‡, lastYearData?.æ¬¡å‘¨ç•™å­˜ç‡, 'percent');
            updateMetric('revenue', currentData.è¥æ”¶, lastWeekData?.è¥æ”¶, lastYearData?.è¥æ”¶, 'number');
            updateMetric('arpu', currentData.ARPU, lastWeekData?.ARPU, lastYearData?.ARPU, 'number');
            updateMetric('deepAccess', currentData.æ·±åº¦è®¿é—®ç‡, lastWeekData?.æ·±åº¦è®¿é—®ç‡, lastYearData?.æ·±åº¦è®¿é—®ç‡, 'percent');
            updateMetric('usageRate', currentData.ä½¿ç”¨ç‡, lastWeekData?.ä½¿ç”¨ç‡, lastYearData?.ä½¿ç”¨ç‡, 'percent');
            updateMetric('vipActive', currentData.å¤§ä¼šå‘˜æ´»è·ƒç‡, lastWeekData?.å¤§ä¼šå‘˜æ´»è·ƒç‡, lastYearData?.å¤§ä¼šå‘˜æ´»è·ƒç‡, 'percent');
        }

        // æ›´æ–°å•ä¸ªæŒ‡æ ‡
        function updateMetric(id, current, lastWeek, lastYear, type) {
            console.log(`æ›´æ–°æŒ‡æ ‡ ${id}:`, { current, lastWeek, lastYear, type });
            
            // æ›´æ–°å½“å‰å€¼
            const valueElement = document.getElementById(id);
            if (valueElement) {
                if (type === 'percent') {
                    valueElement.textContent = current + '%';
                } else if (type === 'number') {
                    valueElement.textContent = formatNumber(current);
                }
            }

            // è®¡ç®—å¹¶æ›´æ–°ç¯æ¯”
            const wowElement = document.getElementById(id + 'WoW');
            if (wowElement) {
                if (lastWeek !== undefined) {
                    const wowChange = calculateChange(current, lastWeek, type);
                    wowElement.textContent = `ç¯æ¯”: ${wowChange}`;
                    wowElement.className = 'change-item ' + getChangeClass(wowChange);
                } else {
                    wowElement.textContent = 'ç¯æ¯”: -';
                    wowElement.className = 'change-item';
                }
            }

            // è®¡ç®—å¹¶æ›´æ–°åŒæ¯”
            const yoyElement = document.getElementById(id + 'YoY');
            if (yoyElement) {
                if (lastYear !== undefined) {
                    const yoyChange = calculateChange(current, lastYear, type);
                    yoyElement.textContent = `åŒæ¯”: ${yoyChange}`;
                    yoyElement.className = 'change-item ' + getChangeClass(yoyChange);
                } else {
                    yoyElement.textContent = 'åŒæ¯”: -';
                    yoyElement.className = 'change-item';
                }
            }
        }

        // è®¡ç®—å˜åŒ–
        function calculateChange(current, previous, type) {
            if (type === 'percent') {
                const change = current - previous;
                return (change >= 0 ? '+' : '') + change.toFixed(2) + 'pp';
            } else {
                const change = ((current - previous) / previous * 100);
                return (change >= 0 ? '+' : '') + change.toFixed(2) + '%';
            }
        }

        // è·å–å˜åŒ–æ ·å¼ç±»ï¼ˆä¸­å›½é£æ ¼ï¼šçº¢æ¶¨ç»¿è·Œï¼‰
        function getChangeClass(changeText) {
            if (changeText.includes('+')) return 'positive'; // çº¢è‰²ï¼ˆå¢é•¿ï¼‰
            if (changeText.includes('-') && !changeText.includes('--')) return 'negative'; // ç»¿è‰²ï¼ˆä¸‹é™ï¼‰
            return '';
        }

        // æ ¼å¼åŒ–æ•°å­—
        function formatNumber(num) {
            if (num >= 10000) {
                return (num / 10000).toFixed(1) + 'ä¸‡';
            }
            return num.toLocaleString();
        }

        // æ›´æ–°å›¾è¡¨
        function updateCharts() {
            console.log('æ›´æ–°å›¾è¡¨...');
            const activePeriod = document.querySelector('.period-btn.active');
            const weeks = activePeriod ? parseInt(activePeriod.dataset.weeks) : 3;
            
            updateActiveUsersChart(weeks);
            updatePaidUsersChart(weeks);
            updateRevenueChart(weeks);
            updateUsageChart(weeks);
        }

        // è·å–æŒ‡å®šå‘¨æœŸçš„æ¯æ—¥æ•°æ®
        function getDailyDataForPeriod(weeks) {
            if (!currentWeek) return { startDate: null, endDate: null };
            
            // æ‰¾åˆ°å½“å‰é€‰æ‹©å‘¨çš„ç»“æŸæ—¥æœŸ
            const currentWeekData = weeklyData.find(item => 
                item.å¹´ä»½ === currentWeek.year && item.å‘¨æ•° === currentWeek.week
            );
            
            if (!currentWeekData) return { startDate: null, endDate: null };
            
            // è§£æç»“æŸæ—¥æœŸ
            const endDateStr = currentWeekData.ç»“å°¾æ—¥æœŸ.replace(/å¹´|æœˆ|æ—¥/g, '/').replace('//', '/');
            const endDate = new Date(endDateStr);
            
            // è®¡ç®—å¼€å§‹æ—¥æœŸï¼ˆå¾€å‰æ¨æŒ‡å®šå‘¨æ•°ï¼‰
            const startDate = new Date(endDate);
            startDate.setDate(startDate.getDate() - (weeks * 7 - 1));
            
            return { startDate, endDate };
        }

        // è¿‡æ»¤æŒ‡å®šæ—¥æœŸèŒƒå›´å†…çš„æ•°æ®
        function filterDataByDateRange(data, startDate, endDate) {
            if (!startDate || !endDate) return [];
            
            return data.filter(item => {
                const itemDate = new Date(item.date);
                return itemDate >= startDate && itemDate <= endDate;
            });
        }

        // æ›´æ–°æ´»è·ƒç”¨æˆ·è¶‹åŠ¿å›¾
        function updateActiveUsersChart(weeks) {
            const ctx = document.getElementById('activeUsersChart');
            if (!ctx) return;
            
            if (charts.activeUsers) {
                charts.activeUsers.destroy();
            }

            const { startDate, endDate } = getDailyDataForPeriod(weeks);
            const filteredData = filterDataByDateRange(window.dailyActiveUsers || [], startDate, endDate);
            
            charts.activeUsers = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: filteredData.map(item => {
                        const date = new Date(item.date);
                        return `${date.getMonth() + 1}/${date.getDate()}`;
                    }),
                    datasets: [{
                        label: 'æ´»è·ƒç”¨æˆ·',
                        data: filteredData.map(item => item.uv),
                        borderColor: '#FF6B35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: getChartOptions('äºº')
            });
        }

        // æ›´æ–°ä»˜è´¹ç”¨æˆ·è¶‹åŠ¿å›¾
        function updatePaidUsersChart(weeks) {
            const ctx = document.getElementById('paidUsersChart');
            if (!ctx) return;
            
            if (charts.paidUsers) {
                charts.paidUsers.destroy();
            }

            const { startDate, endDate } = getDailyDataForPeriod(weeks);
            const filteredData = filterDataByDateRange(window.dailyPaidUsers || [], startDate, endDate);
            
            charts.paidUsers = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: filteredData.map(item => {
                        const date = new Date(item.date);
                        return `${date.getMonth() + 1}/${date.getDate()}`;
                    }),
                    datasets: [{
                        label: 'ä»˜è´¹ç”¨æˆ·',
                        data: filteredData.map(item => item.paidUsers),
                        borderColor: '#FFA366',
                        backgroundColor: 'rgba(255, 163, 102, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: getChartOptions('äºº')
            });
        }

        // æ›´æ–°è¥æ”¶è¶‹åŠ¿å›¾
        function updateRevenueChart(weeks) {
            const ctx = document.getElementById('revenueChart');
            if (!ctx) return;
            
            if (charts.revenue) {
                charts.revenue.destroy();
            }

            const { startDate, endDate } = getDailyDataForPeriod(weeks);
            const filteredData = filterDataByDateRange(window.dailyPaidUsers || [], startDate, endDate);
            
            charts.revenue = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: filteredData.map(item => {
                        const date = new Date(item.date);
                        return `${date.getMonth() + 1}/${date.getDate()}`;
                    }),
                    datasets: [{
                        label: 'è¥æ”¶',
                        data: filteredData.map(item => item.revenue),
                        borderColor: '#FFB366',
                        backgroundColor: 'rgba(255, 179, 102, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: getChartOptions('å…ƒ')
            });
        }

        // æ›´æ–°ä½¿ç”¨ç‡è¶‹åŠ¿å›¾
        function updateUsageChart(weeks) {
            const ctx = document.getElementById('usageChart');
            if (!ctx) return;
            
            if (charts.usage) {
                charts.usage.destroy();
            }

            const { startDate, endDate } = getDailyDataForPeriod(weeks);
            const filteredData = filterDataByDateRange(window.dailyUsageRate || [], startDate, endDate);
            
            charts.usage = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: filteredData.map(item => {
                        const date = new Date(item.date);
                        return `${date.getMonth() + 1}/${date.getDate()}`;
                    }),
                    datasets: [{
                        label: 'ä½¿ç”¨ç‡',
                        data: filteredData.map(item => item.usageRate),
                        borderColor: '#FF6B35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    ...getChartOptions('%'),
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // è·å–å›¾è¡¨é…ç½®
        function getChartOptions(unit) {
            return {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                if (unit === 'äºº' || unit === 'å…ƒ') {
                                    return formatNumber(value) + unit;
                                }
                                return value + unit;
                            }
                        }
                    }
                },
                elements: {
                    point: {
                        radius: 2,
                        hoverRadius: 4
                    }
                }
            };
        }

        // æ›´æ–°Bç«¯æŒ‡æ ‡
        function updateB2BMetrics() {
            console.log('æ›´æ–°Bç«¯æŒ‡æ ‡...');
            const container = document.getElementById('b2bMetrics');
            if (!container) return;
            
            if (b2bData.length === 0) {
                container.innerHTML = '<p>æš‚æ— Bç«¯æ•°æ®</p>';
                return;
            }
            
            const latestData = b2bData[b2bData.length - 1];
            
            const metrics = [
                { label: 'ç­¾çº¦é‡‘é¢', value: latestData.ç­¾çº¦é‡‘é¢ },
                { label: 'å¼€ç¥¨é‡‘é¢', value: latestData.å¼€ç¥¨é‡‘é¢ },
                { label: 'å›æ¬¾é‡‘é¢', value: latestData.å›æ¬¾é‡‘é¢ },
                { label: 'è®¢å•æ•°', value: latestData.è®¢å•æ•° },
                { label: 'æ–°ç­¾', value: latestData.æ–°ç­¾ },
                { label: 'ç»­ç­¾', value: latestData.ç»­ç­¾ }
            ];
            
            container.innerHTML = metrics.map(metric => `
                <div class="b2b-metric-card">
                    <div class="b2b-metric-label">${metric.label}</div>
                    <div class="b2b-metric-value">${metric.value}</div>
                </div>
            `).join('');
        }

        // ç”ŸæˆAIåˆ†æï¼ˆè°ƒç”¨DeepSeek APIï¼‰
        async function generateAIAnalysis() {
            console.log('ç”ŸæˆAIåˆ†æ...');
            if (!currentWeek) return;
            
            const analysisElement = document.getElementById('aiAnalysis');
            if (!analysisElement) return;
            
            analysisElement.innerHTML = '<div class="loading">ğŸ¤– DeepSeekæ­£åœ¨åˆ†ææ•°æ®...</div>';
            
            const currentData = weeklyData.find(item => 
                item.å¹´ä»½ === currentWeek.year && item.å‘¨æ•° === currentWeek.week
            );
            
            const lastWeekData = weeklyData.find(item => 
                item.å¹´ä»½ === currentWeek.year && item.å‘¨æ•° === currentWeek.week - 1
            );
            
            const lastYearData = weeklyData.find(item => 
                item.å¹´ä»½ === currentWeek.year - 1 && item.å‘¨æ•° === currentWeek.week
            );
            
            if (!currentData) {
                analysisElement.innerHTML = '<div class="loading">æš‚æ— æ•°æ®åˆ†æ</div>';
                return;
            }
            
            // è®¡ç®—å…³é”®å˜åŒ–æŒ‡æ ‡
            const metrics = calculateKeyMetrics(currentData, lastWeekData, lastYearData);
            
            // æ„å»ºç²¾ç¡®çš„åˆ†ææç¤ºè¯
            const prompt = `ä½ æ˜¯èµ„æ·±æ•°æ®åˆ†æå¸ˆï¼Œè¯·åŸºäºä»¥ä¸‹å‘¨åº¦ä¸šåŠ¡æ•°æ®è¿›è¡Œä¸“ä¸šåˆ†æï¼š

ã€å½“å‰æ•°æ®ã€‘${currentWeek.year}å¹´ç¬¬${currentWeek.week}å‘¨ï¼š
â€¢ æ´»è·ƒç”¨æˆ·ï¼š${formatNumber(currentData.æ´»è·ƒç”¨æˆ·)}äºº
â€¢ è¥æ”¶ï¼š${formatNumber(currentData.è¥æ”¶)}å…ƒ  
â€¢ ARPUï¼š${currentData.ARPU}å…ƒ
â€¢ æ¬¡å‘¨ç•™å­˜ç‡ï¼š${currentData.æ¬¡å‘¨ç•™å­˜ç‡}%
â€¢ ä½¿ç”¨ç‡ï¼š${currentData.ä½¿ç”¨ç‡}%
â€¢ æ·±åº¦è®¿é—®ç‡ï¼š${currentData.æ·±åº¦è®¿é—®ç‡}%
â€¢ å¤§ä¼šå‘˜æ´»è·ƒç‡ï¼š${currentData.å¤§ä¼šå‘˜æ´»è·ƒç‡}%

${lastWeekData ? `ã€ç¯æ¯”å˜åŒ–ã€‘vsä¸Šå‘¨ï¼š
â€¢ æ´»è·ƒç”¨æˆ·ï¼š${metrics.userWoW}
â€¢ è¥æ”¶ï¼š${metrics.revenueWoW}
â€¢ ARPUï¼š${metrics.arpuWoW}
â€¢ ç•™å­˜ç‡ï¼š${metrics.retentionWoW}
â€¢ ä½¿ç”¨ç‡ï¼š${metrics.usageWoW}` : 'ã€è¯´æ˜ã€‘é¦–å‘¨æ•°æ®ï¼Œæ— ç¯æ¯”å¯¹æ¯”'}

${lastYearData ? `ã€åŒæ¯”å˜åŒ–ã€‘vså»å¹´åŒæœŸï¼š
â€¢ æ´»è·ƒç”¨æˆ·ï¼š${metrics.userYoY}
â€¢ è¥æ”¶ï¼š${metrics.revenueYoY}` : ''}

ã€åˆ†æè¦æ±‚ã€‘è¯·æä¾›3ä¸ªéƒ¨åˆ†ï¼Œæ¯éƒ¨åˆ†2-3ä¸ªè¦ç‚¹ï¼š

1. æ ¸å¿ƒå˜åŒ–ï¼šè¯†åˆ«æœ€å…³é”®çš„æŒ‡æ ‡å˜åŒ–ï¼ˆé‡ç‚¹å…³æ³¨>10%çš„æ˜¾è‘—å˜åŒ–ï¼‰
2. è¶‹åŠ¿åˆ¤æ–­ï¼šåŸºäºæ•°æ®å˜åŒ–åˆ†æä¸šåŠ¡å¥åº·åº¦å’Œå‘å±•è¶‹åŠ¿
3. è¡ŒåŠ¨å»ºè®®ï¼šé’ˆå¯¹å…·ä½“é—®é¢˜ç»™å‡ºå¯æ‰§è¡Œçš„è¿è¥ç­–ç•¥

ã€æ³¨æ„äº‹é¡¹ã€‘
- é‡ç‚¹åˆ†æç”¨æˆ·å¢é•¿ä¸è¥æ”¶çš„å…³è”æ€§
- å…³æ³¨ç•™å­˜ç‡å¯¹é•¿æœŸå‘å±•çš„å½±å“
- æ¯ä¸ªå»ºè®®è¦å…·ä½“å¯æ‰§è¡Œï¼Œé¿å…ç©ºæ³›è¡¨è¿°
- è¯­è¨€ç®€æ´ä¸“ä¸šï¼Œæ¯ä¸ªè¦ç‚¹10-15å­—`;

            try {
                console.log('å¼€å§‹è°ƒç”¨DeepSeek API...');
                
                // è°ƒç”¨DeepSeek API
                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer sk-22da5c080db84c23b4a5c8c54e922763',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            {
                                role: 'system',
                                content: 'ä½ æ˜¯èµ„æ·±ä¸šåŠ¡æ•°æ®åˆ†æå¸ˆï¼Œæ“…é•¿ä»æ•°æ®ä¸­å‘ç°é—®é¢˜å¹¶æå‡ºå…·ä½“å¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚å›ç­”è¦ç®€æ´ç²¾å‡†ï¼Œé‡ç‚¹çªå‡ºï¼Œæ¯ä¸ªå»ºè®®éƒ½è¦å…·ä½“å¯æ‰§è¡Œã€‚'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        temperature: 0.2,  // è¿›ä¸€æ­¥é™ä½éšæœºæ€§
                        max_tokens: 1000,
                        stream: false
                    })
                });
                
                console.log('APIå“åº”çŠ¶æ€:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('APIé”™è¯¯å“åº”:', errorText);
                    throw new Error(`APIè°ƒç”¨å¤±è´¥: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('APIå“åº”æˆåŠŸ');
                
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    const analysis = data.choices[0].message.content;
                    console.log('AIåˆ†æç»“æœ:', analysis);
                    
                    // æ ¼å¼åŒ–AIåˆ†æç»“æœ
                    const formattedAnalysis = formatAIAnalysisOptimized(analysis, currentData, metrics);
                    analysisElement.innerHTML = formattedAnalysis;
                } else {
                    throw new Error('APIè¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸');
                }
                
            } catch (error) {
                console.error('DeepSeek APIè°ƒç”¨å¤±è´¥:', error);
                
                // æ˜¾ç¤ºé”™è¯¯å¹¶åˆ‡æ¢åˆ°ä¼˜åŒ–çš„æœ¬åœ°åˆ†æ
                analysisElement.innerHTML = `
                    <div class="analysis-section">
                        <h5>âš ï¸ APIæš‚æ—¶ä¸å¯ç”¨</h5>
                        <ul><li>æ­£åœ¨åˆ‡æ¢åˆ°æœ¬åœ°æ™ºèƒ½åˆ†æ...</li></ul>
                    </div>
                `;
                
                // 2ç§’ååˆ‡æ¢åˆ°ä¼˜åŒ–çš„æœ¬åœ°åˆ†æ
                setTimeout(() => {
                    console.log('åˆ‡æ¢åˆ°ä¼˜åŒ–æœ¬åœ°åˆ†æ');
                    const fallbackAnalysis = generateOptimizedFallbackAnalysis(currentData, lastWeekData, lastYearData, metrics);
                    analysisElement.innerHTML = fallbackAnalysis;
                }, 2000);
            }
        }

        // è®¡ç®—å…³é”®æŒ‡æ ‡å˜åŒ–
        function calculateKeyMetrics(current, lastWeek, lastYear) {
            const metrics = {};
            
            if (lastWeek) {
                // ç¯æ¯”è®¡ç®—
                metrics.userWoW = calculateChange(current.æ´»è·ƒç”¨æˆ·, lastWeek.æ´»è·ƒç”¨æˆ·, 'number');
                metrics.revenueWoW = calculateChange(current.è¥æ”¶, lastWeek.è¥æ”¶, 'number');
                metrics.arpuWoW = calculateChange(current.ARPU, lastWeek.ARPU, 'number');
                metrics.retentionWoW = calculateChange(current.æ¬¡å‘¨ç•™å­˜ç‡, lastWeek.æ¬¡å‘¨ç•™å­˜ç‡, 'percent');
                metrics.usageWoW = calculateChange(current.ä½¿ç”¨ç‡, lastWeek.ä½¿ç”¨ç‡, 'percent');
                
                // è®¡ç®—æ•°å€¼å˜åŒ–
                metrics.userWoWNum = ((current.æ´»è·ƒç”¨æˆ· - lastWeek.æ´»è·ƒç”¨æˆ·) / lastWeek.æ´»è·ƒç”¨æˆ· * 100).toFixed(1);
                metrics.revenueWoWNum = ((current.è¥æ”¶ - lastWeek.è¥æ”¶) / lastWeek.è¥æ”¶ * 100).toFixed(1);
            }
            
            if (lastYear) {
                // åŒæ¯”è®¡ç®—
                metrics.userYoY = calculateChange(current.æ´»è·ƒç”¨æˆ·, lastYear.æ´»è·ƒç”¨æˆ·, 'number');
                metrics.revenueYoY = calculateChange(current.è¥æ”¶, lastYear.è¥æ”¶, 'number');
                metrics.arpuYoY = calculateChange(current.ARPU, lastYear.ARPU, 'number');
                metrics.retentionYoY = calculateChange(current.æ¬¡å‘¨ç•™å­˜ç‡, lastYear.æ¬¡å‘¨ç•™å­˜ç‡, 'percent');
                metrics.usageYoY = calculateChange(current.ä½¿ç”¨ç‡, lastYear.ä½¿ç”¨ç‡, 'percent');
            }
            
            return metrics;
        }

        // ä¼˜åŒ–çš„AIåˆ†æç»“æœæ ¼å¼åŒ– - æ–°è®¾è®¡é£æ ¼
        function formatAIAnalysisOptimized(analysis, currentData, metrics) {
            try {
                // æ™ºèƒ½è§£æAIå›å¤
                let sections = [];
                
                // å°è¯•æŒ‰æ•°å­—æ ‡é¢˜åˆ†å‰²
                if (analysis.includes('1.') || analysis.includes('1ã€')) {
                    sections = analysis.split(/[1-3][\.\ã€]\s*/).filter(s => s.trim());
                } else if (analysis.includes('æ ¸å¿ƒå˜åŒ–') || analysis.includes('è¶‹åŠ¿åˆ¤æ–­') || analysis.includes('è¡ŒåŠ¨å»ºè®®')) {
                    // æŒ‰å…³é”®è¯åˆ†å‰²
                    const parts = analysis.split(/(?=æ ¸å¿ƒå˜åŒ–|è¶‹åŠ¿åˆ¤æ–­|è¡ŒåŠ¨å»ºè®®)/);
                    sections = parts.filter(s => s.trim());
                } else {
                    // æŒ‰æ®µè½åˆ†å‰²
                    sections = analysis.split('\n\n').filter(s => s.trim());
                }

                const sectionTitles = ['æ ¸å¿ƒè¡¨ç°', 'å…³é”®å˜åŒ–', 'ç­–ç•¥å»ºè®®'];
                let columns = ['', '', ''];
                
                // ç¬¬ä¸€åˆ—ï¼šæ ¸å¿ƒè¡¨ç°
                columns[0] = `
                    <div class="analysis-section">
                        <h5>${sectionTitles[0]}</h5>
                        <div class="analysis-content">
                            <div class="key-metrics-display">
                                <div class="metric-display">
                                    <div class="label">æ´»è·ƒç”¨æˆ·</div>
                                    <div class="value">${formatNumber(currentData.æ´»è·ƒç”¨æˆ·)}</div>
                                </div>
                                <div class="metric-display">
                                    <div class="label">è¥æ”¶</div>
                                    <div class="value">${formatNumber(currentData.è¥æ”¶)}</div>
                                </div>
                            </div>
                            <div class="analysis-text">
                                æœˆæ´»ç”¨æˆ·ä¸è¥æ”¶è¡¨ç°ç¨³å®šï¼ŒARPUä¸º${currentData.ARPU}å…ƒï¼Œç•™å­˜ç‡${currentData.æ¬¡å‘¨ç•™å­˜ç‡}%ï¼Œä½¿ç”¨ç‡${currentData.ä½¿ç”¨ç‡}%ã€‚
                            </div>
                        </div>
                    </div>
                `;

                // å¤„ç†AIåˆ†æçš„å…¶ä»–éƒ¨åˆ†
                sections.slice(0, 2).forEach((section, index) => {
                    // æ¸…ç†å†…å®¹
                    const cleanLines = section
                        .replace(/^[ï¼š:]\s*/, '')
                        .replace(/æ ¸å¿ƒå˜åŒ–[ï¼š:]?|è¶‹åŠ¿åˆ¤æ–­[ï¼š:]?|è¡ŒåŠ¨å»ºè®®[ï¼š:]?/g, '')
                        .split('\n')
                        .map(line => line.replace(/^[-â€¢Â·*]\s*/, '').trim())
                        .filter(line => line.length > 3 && line.length < 60)
                        .slice(0, 4);

                    if (cleanLines.length > 0) {
                        const columnIndex = index + 1;
                        if (columnIndex < 3) {
                            columns[columnIndex] = `
                                <div class="analysis-section">
                                    <h5>${sectionTitles[columnIndex]}</h5>
                                    <div class="analysis-content">
                                        <ul class="analysis-list">
                                            ${cleanLines.map(line => `<li>${line}</li>`).join('')}
                                        </ul>
                                    </div>
                                </div>
                            `;
                        }
                    }
                });

                // å¦‚æœæŸåˆ—ä¸ºç©ºï¼Œæ·»åŠ é»˜è®¤å†…å®¹
                if (!columns[1].includes('analysis-section')) {
                    columns[1] = `
                        <div class="analysis-section">
                            <h5>å…³é”®å˜åŒ–</h5>
                            <div class="analysis-content">
                                <div class="analysis-text">
                                    å„é¡¹æ ¸å¿ƒæŒ‡æ ‡ä¿æŒç¨³å®šï¼Œç”¨æˆ·æ´»è·ƒåº¦è‰¯å¥½ï¼Œè¥æ”¶è¡¨ç°å¹³ç¨³ï¼Œæ•´ä½“ä¸šåŠ¡è¿è¡Œå¥åº·ã€‚
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                if (!columns[2].includes('analysis-section')) {
                    columns[2] = `
                        <div class="analysis-section">
                            <h5>ç­–ç•¥å»ºè®®</h5>
                            <div class="analysis-content">
                                <ul class="analysis-list">
                                    <li>æŒç»­ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</li>
                                    <li>å…³æ³¨æ ¸å¿ƒæŒ‡æ ‡å˜åŒ–</li>
                                    <li>æ¢ç´¢æ–°çš„å¢é•¿æœºä¼š</li>
                                </ul>
                            </div>
                        </div>
                    `;
                }

                // ç”Ÿæˆä¸‰åˆ—å¸ƒå±€
                return `
                    <div class="ai-column">${columns[0]}</div>
                    <div class="ai-column">${columns[1]}</div>
                    <div class="ai-column">${columns[2]}</div>
                `;

            } catch (error) {
                console.error('AIåˆ†ææ ¼å¼åŒ–å¤±è´¥:', error);
                // é™çº§å¤„ç†
                return `
                    <div class="ai-column">
                        <div class="analysis-section">
                            <h5>æ ¸å¿ƒè¡¨ç°</h5>
                            <div class="analysis-content">
                                <div class="key-metrics-display">
                                    <div class="metric-display">
                                        <div class="label">æ´»è·ƒç”¨æˆ·</div>
                                        <div class="value">${formatNumber(currentData.æ´»è·ƒç”¨æˆ·)}</div>
                                    </div>
                                    <div class="metric-display">
                                        <div class="label">è¥æ”¶</div>
                                        <div class="value">${formatNumber(currentData.è¥æ”¶)}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ai-column">
                        <div class="analysis-section">
                            <h5>AIåˆ†æ</h5>
                            <div class="analysis-content">
                                <div class="analysis-text">
                                    ${analysis.substring(0, 150)}...
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ai-column">
                        <div class="analysis-section">
                            <h5>å»ºè®®</h5>
                            <div class="analysis-content">
                                <ul class="analysis-list">
                                    <li>æŒç»­ä¼˜åŒ–äº§å“åŠŸèƒ½</li>
                                    <li>å…³æ³¨ç”¨æˆ·åé¦ˆ</li>
                                    <li>å®šæœŸæ•°æ®å¤ç›˜</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // ä¼˜åŒ–çš„æœ¬åœ°åˆ†æ - ä¸‰åˆ—å¸ƒå±€
        function generateOptimizedFallbackAnalysis(currentData, lastWeekData, lastYearData, metrics) {
            // ç”Ÿæˆæ ¸å¿ƒè¡¨ç°æè¿°
            const performanceText = `æœˆæ´»ç”¨æˆ·${formatNumber(currentData.æ´»è·ƒç”¨æˆ·)}ï¼Œè¥æ”¶${formatNumber(currentData.è¥æ”¶)}å…ƒã€‚ARPUä¸º${currentData.ARPU}å…ƒï¼Œç•™å­˜ç‡${currentData.æ¬¡å‘¨ç•™å­˜ç‡}%ï¼Œä½¿ç”¨ç‡${currentData.ä½¿ç”¨ç‡}%ï¼Œå¤§ä¼šå‘˜æ´»è·ƒç‡${currentData.å¤§ä¼šå‘˜æ´»è·ƒç‡}%ã€‚`;
            
            // åˆ†æå…³é”®å˜åŒ–
            const keyChanges = [];
            if (lastWeekData) {
                const userChangeNum = parseFloat(metrics.userWoWNum);
                const revenueChangeNum = parseFloat(metrics.revenueWoWNum);
                const retentionChange = currentData.æ¬¡å‘¨ç•™å­˜ç‡ - lastWeekData.æ¬¡å‘¨ç•™å­˜ç‡;
                
                if (Math.abs(userChangeNum) >= 5) {
                    keyChanges.push(`ç”¨æˆ·${userChangeNum > 0 ? 'å¢é•¿' : 'ä¸‹é™'}${Math.abs(userChangeNum).toFixed(1)}%`);
                }
                if (Math.abs(revenueChangeNum) >= 10) {
                    keyChanges.push(`è¥æ”¶${revenueChangeNum > 0 ? 'å¢é•¿' : 'ä¸‹é™'}${Math.abs(revenueChangeNum).toFixed(1)}%`);
                }
                if (Math.abs(retentionChange) >= 2) {
                    keyChanges.push(`ç•™å­˜ç‡${retentionChange > 0 ? 'æå‡' : 'ä¸‹é™'}${Math.abs(retentionChange).toFixed(1)}pp`);
                }
            }
            
            if (keyChanges.length === 0) {
                keyChanges.push('å„é¡¹æ ¸å¿ƒæŒ‡æ ‡ä¿æŒç¨³å®š');
                keyChanges.push('ç”¨æˆ·æ´»è·ƒåº¦è¡¨ç°è‰¯å¥½');
                keyChanges.push('è¥æ”¶æ°´å¹³è¿è¡Œå¹³ç¨³');
            }

            // ç”Ÿæˆç­–ç•¥å»ºè®® - æ›´åå‘å…·ä½“è¡ŒåŠ¨
            const strategies = [];
            if (lastWeekData) {
                // åŸºäºå¤§ä¼šå‘˜æ´»è·ƒç‡çš„å…·ä½“å»ºè®®
                if (currentData.å¤§ä¼šå‘˜æ´»è·ƒç‡ <= 50) {
                    strategies.push(`æ¨å‡ºä¼šå‘˜ä¸“å±æ´»åŠ¨æå‡${currentData.å¤§ä¼šå‘˜æ´»è·ƒç‡}%æ´»è·ƒç‡`);
                }
                
                // åŸºäºç•™å­˜ç‡çš„å…·ä½“å»ºè®®
                if (currentData.æ¬¡å‘¨ç•™å­˜ç‡ < 40) {
                    strategies.push(`ä¼˜åŒ–æ–°æ‰‹å¼•å¯¼æµç¨‹ï¼Œç›®æ ‡æå‡ç•™å­˜è‡³45%`);
                } else if (currentData.æ¬¡å‘¨ç•™å­˜ç‡ < 45) {
                    strategies.push(`å¢åŠ ç”¨æˆ·æ¿€æ´»è§¦ç‚¹ï¼Œäº‰å–ç•™å­˜ç‡çªç ´50%`);
                }
                
                // åŸºäºARPUçš„å…·ä½“å»ºè®®
                if (currentData.ARPU < 2.0) {
                    strategies.push(`æµ‹è¯•ä»˜è´¹åŠŸèƒ½å®šä»·ï¼Œç›®æ ‡ARPUæå‡è‡³2.5å…ƒ`);
                } else if (currentData.ARPU < 2.5) {
                    strategies.push(`æ¨å‡ºé«˜ä»·å€¼æœåŠ¡åŒ…ï¼Œè¿›ä¸€æ­¥æå‡ARPU`);
                }
                
                // åŸºäºä½¿ç”¨ç‡çš„å…·ä½“å»ºè®®
                if (currentData.ä½¿ç”¨ç‡ < 70) {
                    strategies.push(`åˆ†æä½æ´»è·ƒç”¨æˆ·è¡Œä¸ºï¼Œä¼˜åŒ–æ ¸å¿ƒåŠŸèƒ½ä½“éªŒ`);
                } else if (currentData.ä½¿ç”¨ç‡ >= 75) {
                    strategies.push(`ç»´æŒé«˜ä½¿ç”¨ç‡ä¼˜åŠ¿ï¼Œæ¢ç´¢ç”¨æˆ·ä»˜è´¹è½¬åŒ–`);
                }
                
                // åŸºäºç”¨æˆ·å˜åŒ–çš„å»ºè®®
                const userChangeNum = parseFloat(metrics.userWoWNum || 0);
                if (userChangeNum < -5) {
                    strategies.push('å¯åŠ¨ç”¨æˆ·å¬å›è®¡åˆ’ï¼Œé‡ç‚¹å…³æ³¨æµå¤±ç”¨æˆ·');
                } else if (userChangeNum > 10) {
                    strategies.push('åŠ å¤§è·å®¢æŠ•å…¥ï¼Œè¶åŠ¿æ‰©å¤§ç”¨æˆ·è§„æ¨¡');
                }
                
                // åŸºäºè¥æ”¶å˜åŒ–çš„å»ºè®®
                const revenueChangeNum = parseFloat(metrics.revenueWoWNum || 0);
                if (revenueChangeNum < -10) {
                    strategies.push('ç´§æ€¥ä¼˜åŒ–ä»˜è´¹è½¬åŒ–æ¼æ–—ï¼Œæå‡å˜ç°æ•ˆç‡');
                }
            }
            
            // å¦‚æœæ²¡æœ‰å…·ä½“é—®é¢˜ï¼Œç»™å‡ºå¢é•¿æ€§å»ºè®®
            if (strategies.length === 0) {
                strategies.push('åˆ¶å®šç”¨æˆ·åˆ†å±‚è¿è¥ç­–ç•¥ï¼Œç²¾ç»†åŒ–ç®¡ç†');
                strategies.push('å»ºç«‹æ•°æ®é©±åŠ¨çš„äº§å“è¿­ä»£æœºåˆ¶');
                strategies.push('æ¢ç´¢æ–°çš„å•†ä¸šåŒ–å˜ç°æ¨¡å¼');
            }
            
            // ç¡®ä¿è‡³å°‘æœ‰3ä¸ªå»ºè®®ï¼Œæœ€å¤š4ä¸ª
            while (strategies.length < 3) {
                if (strategies.length === 1) {
                    strategies.push('å»ºç«‹ç”¨æˆ·åé¦ˆæ”¶é›†å’Œå“åº”æœºåˆ¶');
                } else if (strategies.length === 2) {
                    strategies.push('å®šæœŸè¿›è¡Œç«å“åˆ†æå’Œå¸‚åœºè°ƒç ”');
                }
            }

            // ä¸‰åˆ—å¸ƒå±€
            return `
                <div class="ai-column">
                    <div class="analysis-section">
                        <h5>æ ¸å¿ƒè¡¨ç°</h5>
                        <div class="analysis-content">
                            <div class="key-metrics-display">
                                <div class="metric-display">
                                    <div class="label">æ´»è·ƒç”¨æˆ·</div>
                                    <div class="value">${formatNumber(currentData.æ´»è·ƒç”¨æˆ·)}</div>
                                </div>
                                <div class="metric-display">
                                    <div class="label">è¥æ”¶</div>
                                    <div class="value">${formatNumber(currentData.è¥æ”¶)}</div>
                                </div>
                            </div>
                            <div class="analysis-text">
                                ${performanceText}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ai-column">
                    <div class="analysis-section">
                        <h5>å…³é”®å˜åŒ–</h5>
                        <div class="analysis-content">
                            <ul class="analysis-list">
                                ${keyChanges.slice(0, 4).map(change => `<li>${change}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="ai-column">
                    <div class="analysis-section">
                        <h5>ç­–ç•¥å»ºè®®</h5>
                        <div class="analysis-content">
                            <ul class="analysis-list">
                                ${strategies.slice(0, 4).map(strategy => `<li>${strategy}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
            // æ·±åº¦åˆ†ææ ¸å¿ƒå˜åŒ–
            const coreChanges = [];
            let hasSignificantChange = false;
            
            if (lastWeekData) {
                const userChangeNum = parseFloat(metrics.userWoWNum);
                const revenueChangeNum = parseFloat(metrics.revenueWoWNum);
                const retentionChange = currentData.æ¬¡å‘¨ç•™å­˜ç‡ - lastWeekData.æ¬¡å‘¨ç•™å­˜ç‡;
                const arpuChange = currentData.ARPU - lastWeekData.ARPU;
                
                // ç”¨æˆ·å˜åŒ–åˆ†æï¼ˆæ˜¾è‘—å˜åŒ–â‰¥5%ï¼‰
                if (Math.abs(userChangeNum) >= 5) {
                    hasSignificantChange = true;
                    if (userChangeNum > 0) {
                        coreChanges.push(`ç”¨æˆ·å¢é•¿${userChangeNum.toFixed(1)}%ï¼Œè¡¨ç°ä¼˜ç§€`);
                    } else {
                        coreChanges.push(`ç”¨æˆ·ä¸‹é™${Math.abs(userChangeNum).toFixed(1)}%ï¼Œéœ€å…³æ³¨`);
                    }
                }
                
                // è¥æ”¶å˜åŒ–åˆ†æï¼ˆæ˜¾è‘—å˜åŒ–â‰¥10%ï¼‰
                if (Math.abs(revenueChangeNum) >= 10) {
                    hasSignificantChange = true;
                    if (revenueChangeNum > 0) {
                        coreChanges.push(`è¥æ”¶å¢é•¿${revenueChangeNum.toFixed(1)}%ï¼ŒåŠ¿å¤´è‰¯å¥½`);
                    } else {
                        coreChanges.push(`è¥æ”¶ä¸‹æ»‘${Math.abs(revenueChangeNum).toFixed(1)}%ï¼Œéœ€ä¼˜åŒ–`);
                    }
                }
                
                // ç•™å­˜ç‡å˜åŒ–åˆ†æï¼ˆæ˜¾è‘—å˜åŒ–â‰¥2ppï¼‰
                if (Math.abs(retentionChange) >= 2) {
                    hasSignificantChange = true;
                    if (retentionChange > 0) {
                        coreChanges.push(`ç•™å­˜ç‡æå‡${retentionChange.toFixed(1)}ppï¼Œç”¨æˆ·ç²˜æ€§å¢å¼º`);
                    } else {
                        coreChanges.push(`ç•™å­˜ç‡ä¸‹é™${Math.abs(retentionChange).toFixed(1)}ppï¼Œéœ€è­¦æƒ•`);
                    }
                }
                
                // ARPUå˜åŒ–åˆ†æï¼ˆæ˜¾è‘—å˜åŒ–â‰¥0.2å…ƒï¼‰
                if (Math.abs(arpuChange) >= 0.2) {
                    hasSignificantChange = true;
                    if (arpuChange > 0) {
                        coreChanges.push(`ARPUæå‡${arpuChange.toFixed(2)}å…ƒï¼Œå˜ç°æ”¹å–„`);
                    } else {
                        coreChanges.push(`ARPUä¸‹é™${Math.abs(arpuChange).toFixed(2)}å…ƒï¼Œéœ€å…³æ³¨`);
                    }
                }
            }
            
            // å¦‚æœæ²¡æœ‰æ˜¾è‘—å˜åŒ–ï¼Œåˆ†æå½“å‰ç»å¯¹æ°´å¹³
            if (!hasSignificantChange) {
                if (currentData.ä½¿ç”¨ç‡ >= 75) {
                    coreChanges.push(`ä½¿ç”¨ç‡${currentData.ä½¿ç”¨ç‡}%ä¿æŒé«˜ä½`);
                } else if (currentData.ä½¿ç”¨ç‡ < 60) {
                    coreChanges.push(`ä½¿ç”¨ç‡${currentData.ä½¿ç”¨ç‡}%åä½`);
                }
                
                if (currentData.æ¬¡å‘¨ç•™å­˜ç‡ >= 45) {
                    coreChanges.push(`ç•™å­˜ç‡${currentData.æ¬¡å‘¨ç•™å­˜ç‡}%è¡¨ç°è‰¯å¥½`);
                } else if (currentData.æ¬¡å‘¨ç•™å­˜ç‡ < 40) {
                    coreChanges.push(`ç•™å­˜ç‡${currentData.æ¬¡å‘¨ç•™å­˜ç‡}%éœ€æå‡`);
                }
                
                if (currentData.å¤§ä¼šå‘˜æ´»è·ƒç‡ >= 55) {
                    coreChanges.push(`ä¼šå‘˜æ´»è·ƒç‡${currentData.å¤§ä¼šå‘˜æ´»è·ƒç‡}%è¡¨ç°ä¼˜ç§€`);
                } else if (currentData.å¤§ä¼šå‘˜æ´»è·ƒç‡ <= 45) {
                    coreChanges.push(`ä¼šå‘˜æ´»è·ƒç‡${currentData.å¤§ä¼šå‘˜æ´»è·ƒç‡}%æœ‰å¾…æå‡`);
                }
                
                if (coreChanges.length === 0) {
                    coreChanges.push('å„é¡¹æŒ‡æ ‡å˜åŒ–å¹³ç¨³');
                    coreChanges.push('æ•´ä½“ä¸šåŠ¡è¿è¡Œç¨³å®š');
                }
            }

            // æ™ºèƒ½è¶‹åŠ¿åˆ¤æ–­
            const trends = [];
            if (lastWeekData) {
                const userGrowth = parseFloat(metrics.userWoWNum);
                const revenueGrowth = parseFloat(metrics.revenueWoWNum);
                const retentionChange = currentData.æ¬¡å‘¨ç•™å­˜ç‡ - lastWeekData.æ¬¡å‘¨ç•™å­˜ç‡;
                
                // ç”¨æˆ·ä¸è¥æ”¶å…³è”åˆ†æ
                if (userGrowth > 3 && revenueGrowth > 5) {
                    trends.push(`ç”¨æˆ·è¥æ”¶åŒå¢é•¿ï¼Œä¸šåŠ¡å¥åº·å‘ä¸Š`);
                } else if (userGrowth > 0 && revenueGrowth < -5) {
                    trends.push(`ç”¨æˆ·å¢${userGrowth.toFixed(1)}%è¥æ”¶é™${Math.abs(revenueGrowth).toFixed(1)}%ï¼Œå˜ç°å¾…ä¼˜åŒ–`);
                } else if (userGrowth < -3 && revenueGrowth > 0) {
                    trends.push(`ç”¨æˆ·é™${Math.abs(userGrowth).toFixed(1)}%è¥æ”¶å‡${revenueGrowth.toFixed(1)}%ï¼ŒARPUæå‡`);
                } else if (userGrowth < -5 && revenueGrowth < -10) {
                    trends.push('ç”¨æˆ·è¥æ”¶åŒä¸‹é™ï¼Œéœ€ç´§æ€¥å…³æ³¨');
                } else {
                    trends.push('ç”¨æˆ·è¥æ”¶å˜åŒ–å¹³ç¨³');
                }
                
                // ç•™å­˜ç‡è¶‹åŠ¿åˆ†æ
                if (currentData.æ¬¡å‘¨ç•™å­˜ç‡ >= 45) {
                    if (retentionChange > 0) {
                        trends.push(`ç•™å­˜ç‡${currentData.æ¬¡å‘¨ç•™å­˜ç‡}%ä¸”ä¸Šå‡ï¼Œç”¨æˆ·ç²˜æ€§å¼º`);
                    } else {
                        trends.push(`ç•™å­˜ç‡${currentData.æ¬¡å‘¨ç•™å­˜ç‡}%å¥åº·ï¼Œç”¨æˆ·ç²˜æ€§è‰¯å¥½`);
                    }
                } else if (currentData.æ¬¡å‘¨ç•™å­˜ç‡ < 35) {
                    trends.push(`ç•™å­˜ç‡${currentData.æ¬¡å‘¨ç•™å­˜ç‡}%åä½ï¼Œæµå¤±é£é™©é«˜`);
                } else {
                    trends.push(`ç•™å­˜ç‡${currentData.æ¬¡å‘¨ç•™å­˜ç‡}%ä¸­ç­‰ï¼Œæœ‰æå‡ç©ºé—´`);
                }
                
                // ä½¿ç”¨ç‡è¶‹åŠ¿
                if (currentData.ä½¿ç”¨ç‡ >= 75) {
                    trends.push(`ä½¿ç”¨ç‡${currentData.ä½¿ç”¨ç‡}%ä¼˜ç§€ï¼Œäº§å“å¸å¼•åŠ›å¼º`);
                } else if (currentData.ä½¿ç”¨ç‡ < 60) {
                    trends.push(`ä½¿ç”¨ç‡${currentData.ä½¿ç”¨ç‡}%å¾…æå‡`);
                }
            } else {
                // é¦–å‘¨æ•°æ®åˆ†æ
                if (currentData.æ´»è·ƒç”¨æˆ· >= 100000) {
                    trends.push(`ç”¨æˆ·åŸºæ•°${formatNumber(currentData.æ´»è·ƒç”¨æˆ·)}ï¼Œå‘å±•æ½œåŠ›å¤§`);
                }
                if (currentData.æ¬¡å‘¨ç•™å­˜ç‡ >= 40) {
                    trends.push(`ç•™å­˜ç‡${currentData.æ¬¡å‘¨ç•™å­˜ç‡}%è¡¨ç°ä¸é”™`);
                }
                if (currentData.ä½¿ç”¨ç‡ >= 70) {
                    trends.push(`ä½¿ç”¨ç‡${currentData.ä½¿ç”¨ç‡}%è‰¯å¥½å¼€å±€`);
                }
            }
            
            // ç¡®ä¿è‡³å°‘æœ‰2ä¸ªè¶‹åŠ¿åˆ†æ
            if (trends.length === 0) {
                trends.push('æ•´ä½“æŒ‡æ ‡è¡¨ç°å¹³ç¨³');
                trends.push('æŒç»­è§‚å¯Ÿå…³é”®å˜åŒ–');
            } else if (trends.length === 1) {
                trends.push('å»ºè®®æŒç»­è·Ÿè¸ªæ ¸å¿ƒæŒ‡æ ‡');
            }

            // å…·ä½“å¯æ‰§è¡Œçš„è¡ŒåŠ¨å»ºè®®
            const actions = [];
            
            if (lastWeekData) {
                const userChangeNum = parseFloat(metrics.userWoWNum);
                const revenueChangeNum = parseFloat(metrics.revenueWoWNum);
                const retentionChange = currentData.æ¬¡å‘¨ç•™å­˜ç‡ - lastWeekData.æ¬¡å‘¨ç•™å­˜ç‡;
                const usageChange = currentData.ä½¿ç”¨ç‡ - lastWeekData.ä½¿ç”¨ç‡;
                
                // åŸºäºå®é™…æ•°æ®ç»™å‡ºå…·ä½“å»ºè®®
                let specificActions = [];
                
                // 1. ç”¨æˆ·å˜åŒ–åˆ†æ
                if (Math.abs(userChangeNum) >= 5) {
                    if (userChangeNum > 0) {
                        specificActions.push(`ç”¨æˆ·å¢é•¿${userChangeNum.toFixed(1)}%ï¼ŒåŠ å¤§æŠ•å…¥æ‰©å¤§è§„æ¨¡`);
                    } else {
                        specificActions.push(`ç”¨æˆ·ä¸‹é™${Math.abs(userChangeNum).toFixed(1)}%ï¼Œå¯åŠ¨å¬å›è®¡åˆ’`);
                    }
                }
                
                // 2. è¥æ”¶å˜åŒ–åˆ†æ
                if (Math.abs(revenueChangeNum) >= 5) {
                    if (revenueChangeNum > 0) {
                        specificActions.push(`è¥æ”¶å¢é•¿${revenueChangeNum.toFixed(1)}%ï¼Œä¼˜åŒ–å˜ç°ç­–ç•¥`);
                    } else {
                        specificActions.push(`è¥æ”¶ä¸‹é™${Math.abs(revenueChangeNum).toFixed(1)}%ï¼Œç´§æ€¥ä¼˜åŒ–ä»˜è´¹æµç¨‹`);
                    }
                }
                
                // 3. ç•™å­˜ç‡åˆ†æ
                if (Math.abs(retentionChange) >= 2) {
                    if (retentionChange > 0) {
                        specificActions.push(`ç•™å­˜ç‡æå‡${retentionChange.toFixed(1)}ppï¼Œç»§ç»­å¼ºåŒ–ç”¨æˆ·ä½“éªŒ`);
                    } else {
                        specificActions.push(`ç•™å­˜ç‡ä¸‹é™${Math.abs(retentionChange).toFixed(1)}ppï¼Œä¼˜åŒ–æ–°æ‰‹å¼•å¯¼`);
                    }
                } else if (currentData.æ¬¡å‘¨ç•™å­˜ç‡ < 40) {
                    specificActions.push(`ç•™å­˜ç‡${currentData.æ¬¡å‘¨ç•™å­˜ç‡}%åä½ï¼Œåˆ¶å®šæå‡è®¡åˆ’`);
                }
                
                // 4. å½“å‰çŠ¶æ€åˆ†æï¼ˆåŸºäºç»å¯¹å€¼ï¼‰
                if (currentData.å¤§ä¼šå‘˜æ´»è·ƒç‡ <= 50) {
                    specificActions.push(`æ¨å‡ºä¼šå‘˜ä¸“å±æ´»åŠ¨æå‡${currentData.å¤§ä¼šå‘˜æ´»è·ƒç‡}%æ´»è·ƒç‡`);
                }
                
                if (currentData.ARPU < 2.0) {
                    specificActions.push(`æµ‹è¯•ä»˜è´¹åŠŸèƒ½å®šä»·ï¼Œç›®æ ‡ARPUæå‡è‡³2.5å…ƒ`);
                }
                
                if (currentData.ä½¿ç”¨ç‡ < 70) {
                    specificActions.push(`åˆ†æç”¨æˆ·è¡Œä¸ºï¼Œä¼˜åŒ–${currentData.ä½¿ç”¨ç‡}%ä½¿ç”¨ç‡`);
                } else if (currentData.ä½¿ç”¨ç‡ >= 75) {
                    specificActions.push(`ç»´æŒ${currentData.ä½¿ç”¨ç‡}%é«˜ä½¿ç”¨ç‡ï¼Œæ¢ç´¢ä»˜è´¹è½¬åŒ–`);
                }
                
                // é€‰æ‹©æœ€é‡è¦çš„3ä¸ªå»ºè®®
                if (specificActions.length >= 3) {
                    actions.push(...specificActions.slice(0, 3));
                } else {
                    actions.push(...specificActions);
                    
                    // è¡¥å……é€šç”¨å»ºè®®
                    while (actions.length < 3) {
                        if (actions.length === 1) {
                            actions.push('å®šæœŸåˆ†æç”¨æˆ·è¡Œä¸ºæ•°æ®');
                        } else if (actions.length === 2) {
                            actions.push('å»ºç«‹ç«å“å¯¹æ¯”ç›‘æ§æœºåˆ¶');
                        }
                    }
                }
                
            } else {
                // é¦–å‘¨å»ºè®®
                actions.push('å»ºç«‹å®Œæ•´æ•°æ®ç›‘æ§ä½“ç³»');
                actions.push('åˆ¶å®šæ˜ç¡®ç”¨æˆ·å¢é•¿ç›®æ ‡');
                actions.push('ä¼˜åŒ–æ ¸å¿ƒè½¬åŒ–æ¼æ–—æµç¨‹');
            }

            // ä¸‰åˆ—å¸ƒå±€
            return `
                <div class="ai-column">
                    <div class="analysis-section">
                        <h5>ğŸ“Š æ ¸å¿ƒè¡¨ç°</h5>
                        <div class="key-metrics-compact">
                            <div class="metric-compact">
                                <div class="label">æ´»è·ƒç”¨æˆ·</div>
                                <div class="value">${formatNumber(currentData.æ´»è·ƒç”¨æˆ·)}</div>
                            </div>
                            <div class="metric-compact">
                                <div class="label">è¥æ”¶</div>
                                <div class="value">${formatNumber(currentData.è¥æ”¶)}</div>
                            </div>
                        </div>
                    </div>
                    <div class="analysis-section">
                        <h5>ğŸ” æ ¸å¿ƒå˜åŒ–</h5>
                        <ul>
                            ${coreChanges.slice(0, 3).map(change => `<li>${change}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                <div class="ai-column">
                    <div class="analysis-section">
                        <h5>ğŸ“ˆ è¶‹åŠ¿åˆ¤æ–­</h5>
                        <ul>
                            ${trends.slice(0, 3).map(trend => `<li>${trend}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                <div class="ai-column">
                    <div class="analysis-section">
                        <h5>ğŸ’¡ è¡ŒåŠ¨å»ºè®®</h5>
                        <ul>
                            ${actions.slice(0, 3).map(action => `<li>${action}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
        }

        // é™çº§åˆ†æï¼ˆå½“APIè°ƒç”¨å¤±è´¥æ—¶ï¼‰
        function generateFallbackAnalysis(currentData, lastWeekData) {
            const changes = lastWeekData ? {
                userChange: ((currentData.æ´»è·ƒç”¨æˆ· - lastWeekData.æ´»è·ƒç”¨æˆ·) / lastWeekData.æ´»è·ƒç”¨æˆ· * 100).toFixed(1),
                revenueChange: ((currentData.è¥æ”¶ - lastWeekData.è¥æ”¶) / lastWeekData.è¥æ”¶ * 100).toFixed(1),
                retentionChange: (currentData.æ¬¡å‘¨ç•™å­˜ç‡ - lastWeekData.æ¬¡å‘¨ç•™å­˜ç‡).toFixed(1),
                usageChange: (currentData.ä½¿ç”¨ç‡ - lastWeekData.ä½¿ç”¨ç‡).toFixed(1)
            } : null;

            // ç”Ÿæˆæ™ºèƒ½åˆ†æ
            let keyChanges = [];
            let trends = [];
            let suggestions = [];

            if (changes) {
                // å…³é”®å˜åŒ–åˆ†æ
                if (Math.abs(changes.userChange) > 5) {
                    keyChanges.push(`æ´»è·ƒç”¨æˆ·${changes.userChange > 0 ? 'å¤§å¹…å¢é•¿' : 'æ˜¾è‘—ä¸‹é™'}${Math.abs(changes.userChange)}%`);
                }
                if (Math.abs(changes.revenueChange) > 10) {
                    keyChanges.push(`è¥æ”¶${changes.revenueChange > 0 ? 'å¼ºåŠ²å¢é•¿' : 'æ˜æ˜¾ä¸‹æ»‘'}${Math.abs(changes.revenueChange)}%`);
                }
                if (Math.abs(changes.retentionChange) > 3) {
                    keyChanges.push(`ç•™å­˜ç‡${changes.retentionChange > 0 ? 'æå‡' : 'ä¸‹é™'}${Math.abs(changes.retentionChange)}pp`);
                }

                // è¶‹åŠ¿åˆ†æ
                if (changes.userChange > 0 && changes.revenueChange > 0) {
                    trends.push('ç”¨æˆ·å¢é•¿ä¸è¥æ”¶å¢é•¿å‘ˆæ­£ç›¸å…³ï¼Œä¸šåŠ¡å‘å±•è‰¯å¥½');
                } else if (changes.userChange > 0 && changes.revenueChange < 0) {
                    trends.push('ç”¨æˆ·å¢é•¿ä½†è¥æ”¶ä¸‹é™ï¼Œéœ€å…³æ³¨å˜ç°æ•ˆç‡');
                } else if (changes.userChange < 0 && changes.revenueChange > 0) {
                    trends.push('ç”¨æˆ·å‡å°‘ä½†è¥æ”¶å¢é•¿ï¼ŒARPUæå‡æ˜æ˜¾');
                }

                if (currentData.ä½¿ç”¨ç‡ > 70) {
                    trends.push('ä½¿ç”¨ç‡ä¿æŒé«˜ä½ï¼Œç”¨æˆ·ç²˜æ€§è‰¯å¥½');
                } else if (currentData.ä½¿ç”¨ç‡ < 50) {
                    trends.push('ä½¿ç”¨ç‡åä½ï¼Œéœ€æå‡äº§å“å¸å¼•åŠ›');
                }

                // ç­–ç•¥å»ºè®®
                if (changes.userChange < -5) {
                    suggestions.push('åŠ å¼ºç”¨æˆ·è·å–å’Œå¬å›ç­–ç•¥');
                }
                if (changes.retentionChange < -2) {
                    suggestions.push('ä¼˜åŒ–æ–°ç”¨æˆ·å¼•å¯¼å’Œç•™å­˜æœºåˆ¶');
                }
                if (currentData.ARPU < 2) {
                    suggestions.push('æ¢ç´¢æå‡ARPUçš„å˜ç°æ–¹å¼');
                }
                if (currentData.å¤§ä¼šå‘˜æ´»è·ƒç‡ < 50) {
                    suggestions.push('åŠ å¼ºä¼šå‘˜æƒç›Šå’Œæ´»è·ƒåº¦è¿è¥');
                }
            } else {
                keyChanges = ['å½“å‰ä¸ºé¦–å‘¨æ•°æ®ï¼Œæš‚æ— å¯¹æ¯”åŸºå‡†'];
                trends = ['å»ºè®®å»ºç«‹æ•°æ®åŸºçº¿ï¼ŒæŒç»­è·Ÿè¸ªå…³é”®æŒ‡æ ‡'];
                suggestions = ['åˆ¶å®šæ˜ç¡®çš„å¢é•¿ç›®æ ‡å’Œç›‘æ§ä½“ç³»'];
            }

            // å¦‚æœæ²¡æœ‰æ˜¾è‘—å˜åŒ–ï¼Œæ·»åŠ é»˜è®¤å†…å®¹
            if (keyChanges.length === 0) {
                keyChanges.push('å„é¡¹æŒ‡æ ‡ç›¸å¯¹ç¨³å®šï¼Œæ— æ˜¾è‘—æ³¢åŠ¨');
            }
            if (trends.length === 0) {
                trends.push('æ•´ä½“ä¸šåŠ¡è¡¨ç°å¹³ç¨³');
            }
            if (suggestions.length === 0) {
                suggestions.push('æŒç»­ä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼Œå…³æ³¨é•¿æœŸå¢é•¿');
            }

            return `
                <div class="analysis-section">
                    <h5>ğŸ“Š æ ¸å¿ƒè¡¨ç°</h5>
                    <div class="key-metrics-compact">
                        <div class="metric-compact">
                            <div class="label">æ´»è·ƒç”¨æˆ·</div>
                            <div class="value">${formatNumber(currentData.æ´»è·ƒç”¨æˆ·)}</div>
                        </div>
                        <div class="metric-compact">
                            <div class="label">è¥æ”¶</div>
                            <div class="value">${formatNumber(currentData.è¥æ”¶)}</div>
                        </div>
                        <div class="metric-compact">
                            <div class="label">ç•™å­˜ç‡</div>
                            <div class="value">${currentData.æ¬¡å‘¨ç•™å­˜ç‡}%</div>
                        </div>
                        <div class="metric-compact">
                            <div class="label">ARPU</div>
                            <div class="value">${currentData.ARPU}</div>
                        </div>
                    </div>
                </div>
                
                <div class="analysis-section">
                    <h5>ğŸ“ˆ å…³é”®å˜åŒ–åˆ†æ</h5>
                    <ul>
                        ${keyChanges.map(change => `<li>${change}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="analysis-section">
                    <h5>ğŸ“Š å¢é•¿è¶‹åŠ¿åˆ†æ</h5>
                    <ul>
                        ${trends.map(trend => `<li>${trend}</li>`).join('')}
                    </ul>
                </div>
                
                <div class="analysis-section">
                    <h5>ğŸ’¡ è¿è¥ç­–ç•¥å»ºè®®</h5>
                    <ul>
                        ${suggestions.map(suggestion => `<li>${suggestion}</li>`).join('')}
                    </ul>
                </div>
            `;
        }
    </script>
</body>
</html>