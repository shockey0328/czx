# 确保搜索数据看板数据准确性指南

## 🎯 目标

确保搜索数据看板显示的是真实的 CSV 数据，而不是示例数据。

---

## ✅ 已实现的改进

### 1. 优先加载真实数据
- 系统会首先尝试加载 CSV 文件
- 只有在加载失败时才使用示例数据
- 每个文件都有独立的加载状态

### 2. 详细的日志输出
打开浏览器控制台（F12），你会看到：

**成功加载时**：
```
尝试加载第1周搜索词，状态: 200
✓ 第1周搜索词加载成功，共 100 条真实数据
...
========================================
✓ 所有数据均为真实 CSV 数据
========================================
```

**部分失败时**：
```
尝试加载第1周搜索词，状态: 404
✗ 第1周搜索词加载失败: HTTP 404
⚠️ 使用示例数据替代第1周数据
...
========================================
⚠️ 警告：部分数据使用示例数据
请检查 CSV 文件是否存在且格式正确
========================================
```

### 3. 可视化警告提示
如果使用了示例数据，页面顶部会显示黄色警告条：
```
⚠️ 部分数据使用示例数据（CSV文件加载失败）- 请检查文件路径和网络连接
```

---

## 🔍 诊断工具

### 使用诊断工具检查数据加载

1. **启动本地服务器**
   ```bash
   python -m http.server 8000
   ```

2. **访问诊断工具**
   ```
   http://localhost:8000/搜索数据看板（周度）/诊断工具.html
   ```

3. **运行检测**
   - 点击"开始检测"按钮检查文件是否存在
   - 点击"测试数据加载"按钮测试数据加载
   - 查看数据预览确认内容正确

4. **查看诊断结果**
   - ✓ 诊断通过：所有文件正常，可以显示真实数据
   - ⚠️ 发现问题：查看错误列表和建议

---

## 📋 验证数据准确性的步骤

### 步骤1: 启动本地服务器

**必须通过 HTTP 服务器访问**，不能直接打开 HTML 文件！

```bash
# 方法1: Python
python -m http.server 8000

# 方法2: 双击脚本
启动本地服务器.bat
```

### 步骤2: 打开浏览器控制台

1. 访问 http://localhost:8000
2. 按 F12 打开开发者工具
3. 切换到 Console 标签

### 步骤3: 切换到搜索数据看板

1. 确保"周度"按钮已选中
2. 在下拉选择器中选择"搜索数据"

### 步骤4: 检查控制台日志

查找以下关键信息：

**✓ 数据加载成功**：
```
✓ 第1周搜索词加载成功，共 100 条真实数据
✓ 搜索行为漏斗加载成功，共 8 条真实数据
✓ 搜索转化率加载成功，共 56 条真实数据
✓ 搜索功能留存加载成功，共 8 条真实数据
========================================
✓ 所有数据均为真实 CSV 数据
========================================
```

**✗ 数据加载失败**：
```
✗ 第1周搜索词加载失败: HTTP 404
⚠️ 使用示例数据替代第1周数据
========================================
⚠️ 警告：部分数据使用示例数据
========================================
```

### 步骤5: 验证数据内容

1. **查看具体数值**
   - 检查概览卡片的数字是否符合预期
   - 查看热搜词是否是真实的关键词
   - 确认转化率数值在合理范围内

2. **对比 CSV 文件**
   - 打开 CSV 文件查看原始数据
   - 对比看板显示的数据是否一致

3. **检查数据更新**
   - 修改 CSV 文件
   - 刷新页面（Ctrl + F5）
   - 确认数据已更新

---

## 🛠️ 常见问题和解决方案

### 问题1: 显示示例数据而不是真实数据

**症状**：
- 控制台显示"使用示例数据"
- 页面顶部有黄色警告条
- 数据看起来不真实

**原因**：
1. 没有通过 HTTP 服务器访问
2. CSV 文件路径不正确
3. CSV 文件不存在或损坏
4. 文件编码问题

**解决方案**：

#### A. 确保通过 HTTP 服务器访问
```bash
# 启动服务器
python -m http.server 8000

# 访问
http://localhost:8000

# ✗ 错误方式
file:///E:/橙子学数据看板/index.html
```

#### B. 检查文件是否存在
```bash
# 在项目目录执行
dir "搜索数据看板（周度）\*.csv"

# 应该看到：
# 第1周搜索词.csv
# 第2周搜索词.csv
# ...
# 搜索行为漏斗.csv
# 搜索转化率.csv
# 搜索功能留存看板.csv
```

#### C. 使用诊断工具
```
访问: http://localhost:8000/搜索数据看板（周度）/诊断工具.html
运行检测，查看详细错误信息
```

#### D. 检查文件编码
```bash
# CSV 文件必须是 UTF-8 编码
# 如果是其他编码，用文本编辑器转换：
# 1. 用记事本打开 CSV 文件
# 2. 另存为 → 编码选择 UTF-8
# 3. 保存
```

### 问题2: 数据不更新

**症状**：
- 修改了 CSV 文件
- 刷新页面后数据没变

**解决方案**：

1. **强制刷新**
   ```
   按 Ctrl + Shift + R (Windows)
   或 Cmd + Shift + R (Mac)
   ```

2. **清除缓存**
   ```
   F12 → Network 标签 → 勾选 "Disable cache"
   ```

3. **检查文件是否保存**
   ```
   确认 CSV 文件已保存
   查看文件修改时间
   ```

### 问题3: 部分数据正常，部分数据是示例

**症状**：
- 控制台显示部分文件加载成功
- 部分文件加载失败

**解决方案**：

1. **查看具体哪个文件失败**
   ```
   查看控制台日志
   找到 "✗" 标记的文件
   ```

2. **检查该文件**
   ```bash
   # 检查文件是否存在
   dir "搜索数据看板（周度）\失败的文件名.csv"
   
   # 检查文件内容
   type "搜索数据看板（周度）\失败的文件名.csv"
   ```

3. **验证文件格式**
   ```
   - 第一行必须是列名（header）
   - 数据从第二行开始
   - 使用逗号分隔
   - 没有多余的空行
   ```

---

## 📊 CSV 文件格式要求

### 搜索词文件格式
```csv
keywords,pv,uv
期末,3667,320
数学,1701,221
```

### 漏斗文件格式
```csv
week_key,date_range,search_pv,click_pv,click_rate_pv_pct,any_usage_pv,usage_rate_vs_click_pv_pct
W01,01-01 ~ 01-07,604115,418525,69.28,68676,11.37
```

### 转化率文件格式
```csv
dt,搜索转化率
2026-01-01,18.5
2026-01-02,19.2
```

### 留存文件格式
```csv
cohort_week,week_0,week_1,week_2,...
2026-01-01,100,25.3,18.7,...
```

---

## ✅ 验证清单

在部署前，确认以下所有项：

- [ ] 通过 HTTP 服务器访问（不是 file:// 协议）
- [ ] 所有 CSV 文件都存在
- [ ] CSV 文件编码为 UTF-8
- [ ] CSV 文件格式正确（有 header，数据完整）
- [ ] 浏览器控制台显示"所有数据均为真实 CSV 数据"
- [ ] 没有黄色警告条
- [ ] 数据内容与 CSV 文件一致
- [ ] 修改 CSV 后刷新能看到更新

---

## 🚀 部署到生产环境

### 本地验证通过后

1. **提交更改**
   ```bash
   git add .
   git commit -m "更新搜索数据"
   git push
   ```

2. **Vercel 自动部署**
   - 等待约 30 秒
   - 访问 Vercel 网址

3. **在线验证**
   - 打开浏览器控制台
   - 检查数据加载日志
   - 确认显示真实数据

---

## 📞 需要帮助？

如果仍然有问题：

1. **运行诊断工具**
   ```
   http://localhost:8000/搜索数据看板（周度）/诊断工具.html
   ```

2. **截图控制台日志**
   - 按 F12
   - Console 标签
   - 截图所有日志

3. **检查文件列表**
   ```bash
   dir "搜索数据看板（周度）\*.csv" /b
   ```

4. **查看文件内容**
   ```bash
   type "搜索数据看板（周度）\第1周搜索词.csv"
   ```

---

**现在你可以确保搜索数据看板显示的是准确的真实数据了！** ✅
