# 数据看板问题解决方案

## 当前状态

✅ **搜索数据看板（周度）** - 正常工作
❌ **核心数据看板（周度）** - 需要修复
❌ **各模块渗透率看板（月度）** - 需要修复
❌ **核心数据看板（月度）** - React应用，需要单独运行

## 问题原因

1. **编码问题**：CSV文件使用GB2312编码，但之前的转换脚本默认使用UTF-8
2. **数据格式问题**：CSV中的百分号（如"46%"）和"第X周"等格式需要特殊处理

## 解决步骤

### 第一步：重新生成所有data.js文件

运行更新脚本（已修复编码问题）：

```bash
更新数据.bat
```

这会使用新的 `convert_csv_to_js_v2.ps1` 脚本，自动检测CSV文件编码（GB2312或UTF-8）。

### 第二步：测试各个看板

打开 `测试所有看板.html` 文件，点击每个看板的"测试"按钮，检查data.js是否正确生成。

### 第三步：打开统一看板

双击 `index.html` 或运行 `测试看板.bat`

## 已完成的修复

### 1. 编码检测脚本 ✅
- 创建了 `convert_csv_to_js_v2.ps1`
- 自动检测GB2312和UTF-8编码
- 正确处理中文字符

### 2. 核心数据看板数据加载 ✅
- 修改了 `核心数据看板（周度）/index.html`
- 添加了百分号处理（"46%" → 46）
- 添加了"第X周"格式处理
- 修复了B端数据字段映射

### 3. 渗透率看板数据加载 ✅
- 修改了 `各模块渗透率看板（月度）/script.js`
- 添加了嵌入数据解析函数
- 正确处理月份数据

## 测试清单

- [ ] 运行 `更新数据.bat`
- [ ] 检查是否生成了3个data.js文件：
  - [ ] `搜索数据看板（周度）/data.js`
  - [ ] `核心数据看板（周度）/data.js`
  - [ ] `各模块渗透率看板（月度）/data.js`
- [ ] 打开 `测试所有看板.html` 测试每个看板
- [ ] 打开 `index.html` 测试统一入口
- [ ] 切换不同看板类型，确认都能正常显示

## 如果还有问题

### 问题1：中文显示乱码
**解决方法**：
1. 检查CSV文件编码（应该是GB2312或UTF-8）
2. 重新运行 `更新数据.bat`
3. 强制刷新浏览器（Ctrl+F5）

### 问题2：数据显示为NaN或undefined
**解决方法**：
1. 打开浏览器控制台（F12）
2. 查看错误信息
3. 检查CSV文件中的数据格式
4. 确认字段名称与代码中的一致

### 问题3：看板完全空白
**解决方法**：
1. 检查data.js文件是否存在
2. 打开浏览器控制台查看错误
3. 确认HTML文件中有 `<script src="data.js"></script>`

## 文件说明

### 核心文件
- `convert_csv_to_js_v2.ps1` - 新版转换脚本（支持编码检测）
- `更新数据.bat` - 一键更新所有数据
- `测试所有看板.html` - 测试工具

### 已修改的文件
- `核心数据看板（周度）/index.html` - 添加了data.js加载和数据处理
- `各模块渗透率看板（月度）/index.html` - 添加了data.js引用
- `各模块渗透率看板（月度）/script.js` - 添加了嵌入数据解析

## 下一步

1. 运行 `更新数据.bat`
2. 打开 `测试所有看板.html` 验证
3. 如果测试通过，打开 `index.html` 使用统一看板
4. 如果还有问题，查看浏览器控制台的错误信息
