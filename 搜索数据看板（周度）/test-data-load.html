<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试数据加载</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .result {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .success { border-left: 4px solid #4CAF50; }
        .error { border-left: 4px solid #f44336; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>搜索数据看板 - 数据加载测试</h1>
    <div id="results"></div>

    <script>
        const resultsDiv = document.getElementById('results');

        async function testDataLoad() {
            resultsDiv.innerHTML = '<div class="result">正在测试数据加载...</div>';
            
            const tests = [
                { name: '第1周搜索词', file: '第1周搜索词.csv' },
                { name: '搜索行为漏斗', file: '搜索行为漏斗.csv' },
                { name: '搜索转化率', file: '搜索转化率.csv' },
                { name: '搜索功能留存', file: '搜索功能留存看板.csv' }
            ];

            let html = '';

            for (const test of tests) {
                try {
                    console.log(`测试加载: ${test.file}`);
                    const response = await fetch(test.file);
                    
                    if (!response.ok) {
                        html += `
                            <div class="result error">
                                <h3>❌ ${test.name}</h3>
                                <p>HTTP状态: ${response.status}</p>
                                <p>文件: ${test.file}</p>
                            </div>
                        `;
                        continue;
                    }

                    const text = await response.text();
                    const lines = text.trim().split('\n');
                    const headers = lines[0];
                    const dataRows = lines.length - 1;

                    html += `
                        <div class="result success">
                            <h3>✅ ${test.name}</h3>
                            <p><strong>文件:</strong> ${test.file}</p>
                            <p><strong>数据行数:</strong> ${dataRows}</p>
                            <p><strong>表头:</strong> ${headers}</p>
                            <details>
                                <summary>查看前5行数据</summary>
                                <pre>${lines.slice(0, 6).join('\n')}</pre>
                            </details>
                        </div>
                    `;

                } catch (error) {
                    html += `
                        <div class="result error">
                            <h3>❌ ${test.name}</h3>
                            <p>错误: ${error.message}</p>
                            <p>文件: ${test.file}</p>
                            <pre>${error.stack}</pre>
                        </div>
                    `;
                }
            }

            resultsDiv.innerHTML = html;
        }

        // 页面加载时自动测试
        window.addEventListener('load', testDataLoad);
    </script>
</body>
</html>
