# 橙子学数据看板 - 最终使用指南

## 快速开始（3步）

### 第1步：生成数据文件
```bash
双击运行：更新数据.bat
```
等待转换完成（约10-30秒）

### 第2步：测试验证
```bash
双击运行：完整测试.bat
```
在浏览器中测试所有看板

### 第3步：使用看板
```bash
双击打开：index.html
```
开始使用统一数据看板！

---

## 详细说明

### 一、数据更新

当CSV文件更新后，运行以下脚本：

**方式1：一键更新（推荐）**
```bash
更新数据.bat
```

**方式2：手动更新**
```powershell
# 搜索数据
powershell -ExecutionPolicy Bypass -File "convert_csv_to_js_v2.ps1" -FolderPath "搜索数据看板（周度）"

# 核心数据
powershell -ExecutionPolicy Bypass -File "convert_csv_to_js_v2.ps1" -FolderPath "核心数据看板（周度）"

# 渗透率数据
powershell -ExecutionPolicy Bypass -File "convert_csv_to_js_v2.ps1" -FolderPath "各模块渗透率看板（月度）"
```

### 二、测试验证

**完整测试（推荐）**
```bash
完整测试.bat
```
自动打开所有测试页面

**单独测试**
- `测试所有看板.html` - 测试三个看板的data.js
- `测试核心数据看板.html` - 测试核心数据和趋势图
- `测试渗透率看板.html` - 测试渗透率数据和字段映射

### 三、使用看板

**统一入口**
```bash
index.html
```

**功能说明**：
- 顶部切换：周度 ↔ 月度
- 下拉选择：不同类型的看板
  - 周度：核心数据、搜索数据
  - 月度：核心数据（React）、各模块渗透率

**单独打开**
- `搜索数据看板（周度）/index.html`
- `核心数据看板（周度）/index.html`
- `各模块渗透率看板（月度）/index.html`

---

## 已解决的问题

### ✅ 问题1：数据加载失败
**原因**：浏览器CORS策略阻止读取本地CSV文件

**解决**：将CSV转换为JavaScript文件，数据直接嵌入页面

### ✅ 问题2：中文乱码
**原因**：CSV文件使用GB2312编码，但脚本默认UTF-8

**解决**：创建了自动检测编码的转换脚本（convert_csv_to_js_v2.ps1）

### ✅ 问题3：核心数据看板趋势图错误
**原因**：CSV字段名与代码期望的字段名不匹配

**解决**：修改数据加载代码，正确映射字段名
- 活跃用户：`dt` → `date`, `uv` → `uv`
- 付费用户：`dt` → `date`, `付费用户` → `paidUsers`, `营收` → `revenue`
- 使用率：`date` → `date`, `使用率百分比` → `usageRate`

### ✅ 问题4：渗透率看板空白
**原因**：CSV字段名（2025年3月）与显示标签（25年3月）不匹配

**解决**：添加字段映射，自动转换CSV字段名到显示标签

---

## 文件结构

```
橙子学数据看板/
├── index.html                          # 统一入口
├── main.js                             # 看板切换逻辑
├── styles.css                          # 样式
│
├── 更新数据.bat                        # 一键更新数据
├── 完整测试.bat                        # 完整测试工具
├── convert_csv_to_js_v2.ps1            # CSV转换脚本（支持编码检测）
│
├── 测试所有看板.html                   # 测试工具
├── 测试核心数据看板.html               # 核心数据测试
├── 测试渗透率看板.html                 # 渗透率测试
│
├── 最终使用指南.md                     # 本文档
├── 趋势图修复说明.md                   # 核心数据看板修复说明
├── 渗透率看板修复说明.md               # 渗透率看板修复说明
│
├── 搜索数据看板（周度）/
│   ├── index.html                      # 看板页面
│   ├── app.js                          # 业务逻辑（已修改）
│   ├── data.js                         # 嵌入数据（自动生成）
│   └── *.csv                           # 原始CSV文件
│
├── 核心数据看板（周度）/
│   ├── index.html                      # 看板页面（已修改）
│   ├── data.js                         # 嵌入数据（自动生成）
│   └── *_utf8.csv                      # 原始CSV文件
│
└── 各模块渗透率看板（月度）/
    ├── index.html                      # 看板页面（已修改）
    ├── script.js                       # 业务逻辑（已修改）
    ├── data.js                         # 嵌入数据（自动生成）
    └── 各模块渗透率.csv                # 原始CSV文件
```

---

## 常见问题

### Q1: 更新数据后看板没有变化？
**解决**：强制刷新浏览器（Ctrl+F5）清除缓存

### Q2: 某个看板显示空白？
**步骤**：
1. 按F12打开浏览器控制台
2. 查看Console标签的错误信息
3. 检查对应的data.js文件是否存在
4. 运行对应的测试页面验证数据

### Q3: 趋势图显示异常？
**检查**：
1. 打开 `测试核心数据看板.html`
2. 测试数据结构
3. 查看字段名是否正确
4. 参考 `趋势图修复说明.md`

### Q4: 渗透率看板没有数据？
**检查**：
1. 打开 `测试渗透率看板.html`
2. 测试字段映射
3. 确认CSV字段名正确
4. 参考 `渗透率看板修复说明.md`

### Q5: 批处理脚本报错？
**解决**：
1. 右键点击脚本，选择"以管理员身份运行"
2. 或者手动执行PowerShell命令

### Q6: 月度核心数据看板无法显示？
**说明**：这是React应用，需要单独运行：
```bash
cd 核心数据看板（月度）
npm install  # 首次运行
npm start
```

---

## 技术特点

### 1. 完全离线
- 无需HTTP服务器
- 无需网络连接
- 双击HTML即可使用

### 2. 自动编码检测
- 支持GB2312和UTF-8
- 自动处理中文字符
- 避免乱码问题

### 3. 智能字段映射
- 自动匹配CSV字段名
- 处理不同的日期格式
- 支持百分号等特殊格式

### 4. 易于更新
- 一键脚本更新所有数据
- 保留原始CSV文件
- 支持增量更新

---

## 验证清单

使用前请确认：

- [ ] 运行 `更新数据.bat` 成功
- [ ] 三个data.js文件都已生成
- [ ] 运行 `完整测试.bat` 所有测试通过
- [ ] 打开 `index.html` 可以正常显示
- [ ] 周度/月度切换正常
- [ ] 各个看板都能正常显示数据
- [ ] 浏览器控制台无错误

---

## 获取帮助

如果遇到问题：

1. **查看文档**
   - `最终使用指南.md`（本文档）
   - `趋势图修复说明.md`
   - `渗透率看板修复说明.md`

2. **运行测试**
   - `完整测试.bat`
   - 查看具体哪个环节出错

3. **检查控制台**
   - 按F12打开开发者工具
   - 查看Console标签的错误信息

4. **重新生成**
   - 运行 `更新数据.bat`
   - 强制刷新浏览器（Ctrl+F5）

---

## 更新日志

### v2.0 - 离线版本
- ✅ 解决CORS问题，支持完全离线使用
- ✅ 自动编码检测，修复中文乱码
- ✅ 修复核心数据看板趋势图
- ✅ 修复渗透率看板字段映射
- ✅ 创建完整的测试工具
- ✅ 统一看板入口

### v1.0 - 初始版本
- 四个独立的数据看板
- 需要HTTP服务器运行
- 存在编码和数据加载问题

---

**祝使用愉快！** 🎉
