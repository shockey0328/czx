# 月度核心数据看板升级说明

## 升级需求

根据周度核心数据看板的设计，对月度核心数据看板进行全面升级。

## 主要升级内容

### 1. 核心数据指标 - 增加同比数据
**当前状态**：只有环比数据
**升级目标**：
- 显示环比（与上月对比）
- 显示同比（与去年同月对比）
- 使用中国风格：红涨绿跌

**指标包括**：
- 月活用户
- 次月留存率
- 营收
- ARPU
- 使用率
- 大会员活跃率

### 2. 趋势分析 - 简化并支持时间范围切换
**当前状态**：显示所有月份的4个图表（月活、营收、留存率、ARPU+ARPPU）
**升级目标**：
- 只显示3个图表：月活、营收、留存率
- 移除ARPPU，只保留ARPU
- 支持切换时间范围：3个月/6个月/12个月
- 默认显示3个月

### 3. AI数据分析
**参考**：周度看板的AI分析模块
**功能**：
- 关键变化分析
- 增长趋势分析
- 运营策略建议
- 使用DeepSeek AI
- 支持刷新分析

### 4. 小橙子AI助手
**参考**：周度看板的小橙子助手
**功能**：
- 固定在页面左侧
- 点击打开对话框
- 智能对话分析
- 快捷问题建议
- 对话历史记忆

### 5. B端核心数据
**新增模块**：
- 签约金额
- 开票金额
- 到款金额
- 订单数
- 新签
- 续签

## 数据结构

### 月度核心数据.csv
```csv
年份,月份,月活,次月留存,营收,订单,ARPU,ARPPU,深度访问率,使用率,大会员活跃率
25年,1月,288582,43%,569695,6538,1.97,88.1,83%,63%,80%
25年,2月,265432,41%,523456,6123,1.97,85.5,82%,62%,78%
...
```

### B端核心数据.csv
```csv
年份,月份,签约金额,开票金额,到款金额,订单数,新签,续签
25年,1月,45.6万,38.2万,42.1万,12,5,7
25年,2月,52.3万,41.5万,38.9万,15,6,9
...
```

## 技术实现

### 1. 同比计算
```javascript
// 获取去年同月数据
function getYoYData(year, month) {
    return monthlyData.find(d => 
        d.年份 === year - 1 && d.月份 === month
    );
}

// 计算同比变化
function calculateYoY(current, lastYear) {
    if (!lastYear) return null;
    return ((current - lastYear) / lastYear * 100).toFixed(1);
}
```

### 2. 时间范围过滤
```javascript
// 根据选择的时间范围过滤数据
function getFilteredData(months) {
    const currentIndex = monthlyData.findIndex(d => 
        d.年份 === currentMonth.year && d.月份 === currentMonth.month
    );
    return monthlyData.slice(
        Math.max(0, currentIndex - months + 1),
        currentIndex + 1
    );
}
```

### 3. AI分析集成
```javascript
// DeepSeek API调用
async function generateAIAnalysis() {
    const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
        method: 'POST',
        headers: {
            'Authorization': 'Bearer YOUR_API_KEY',
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            model: 'deepseek-chat',
            messages: [{
                role: 'system',
                content: '你是一个专业的数据分析师...'
            }, {
                role: 'user',
                content: `分析以下月度数据：${JSON.stringify(currentData)}`
            }]
        })
    });
    return await response.json();
}
```

### 4. 小橙子助手
```javascript
// 初始化AI助手
function setupAIAssistant() {
    const assistantBtn = document.getElementById('aiAssistantBtn');
    const chatModal = document.getElementById('aiChatModal');
    
    assistantBtn.addEventListener('click', () => {
        chatModal.classList.toggle('show');
    });
    
    // 发送消息
    document.getElementById('aiChatSend').addEventListener('click', sendMessage);
}
```

## 样式设计

### 配色方案
- 主色：`#FF6B35`（橙色）
- 辅助色：`#FFA366`（浅橙）
- 背景：`#f5f5f5`（浅灰）
- 文字：`#333`（深灰）

### 布局结构
```
┌─────────────────────────────────────┐
│          顶部导航栏                  │
│  Logo + 标题 + 月份选择器            │
└─────────────────────────────────────┘
┌─────────────────────────────────────┐
│      核心数据指标（6个卡片）         │
│  月活 | 留存 | 营收 | ARPU | 使用率 | 大会员 │
│  环比 + 同比                         │
└─────────────────────────────────────┘
┌──────────────────┬──────────────────┐
│   趋势分析       │   B端核心数据     │
│  3/6/12月切换    │   6个指标卡片     │
│  3个图表         │                  │
└──────────────────┴──────────────────┘
┌─────────────────────────────────────┐
│          AI数据分析                  │
│  关键变化 | 趋势分析 | 策略建议      │
└─────────────────────────────────────┘

[小橙子] ← 固定在左侧
```

## 实施步骤

1. ✅ 创建基础HTML结构
2. ✅ 添加样式（参考周度看板）
3. ✅ 实现数据加载
4. ✅ 实现核心指标显示（含同比）
5. ✅ 实现趋势图表（含时间范围切换）
6. ✅ 实现B端数据展示
7. ✅ 集成AI分析
8. ✅ 集成小橙子助手
9. ✅ 测试和优化

## 注意事项

1. **数据格式**：确保CSV中有足够的历史数据用于同比计算
2. **API密钥**：需要配置DeepSeek API密钥
3. **响应式**：确保移动端显示正常
4. **性能**：优化图表渲染性能
5. **错误处理**：添加数据加载失败的提示

## 测试清单

- [ ] 月份选择器正常工作
- [ ] 核心指标显示正确（含环比和同比）
- [ ] 趋势图表显示正确
- [ ] 时间范围切换正常（3/6/12月）
- [ ] B端数据显示正确
- [ ] AI分析功能正常
- [ ] 小橙子助手对话正常
- [ ] 移动端显示正常
- [ ] 数据更新后刷新正常

## 后续优化

1. 添加数据导出功能
2. 支持自定义时间范围
3. 增加更多AI分析维度
4. 优化小橙子的对话能力
5. 添加数据对比功能
